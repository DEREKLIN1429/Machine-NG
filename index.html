<!DOCTYPE html>
<html>
<head>
<base target="_top">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è¨­å‚™ç¶­ä¿®è¨˜éŒ„ App</title>

<style>
Â  Â  /* --- è®Šæ•¸å®šç¾© --- */
Â  Â  :root {
Â  Â  Â  Â  --main-bg-color: #f7f7f7;
Â  Â  Â  Â  --card-bg-color: #ffffff;
Â  Â  Â  Â  --primary-color: #007bff;
Â  Â  Â  Â  --success-color: #28a745;
Â  Â  Â  Â  --danger-color: #dc3545;
Â  Â  Â  Â  --view-color: #343a40;
Â  Â  Â  Â  --copy-color: #ffc107;
Â  Â  }

Â  Â  /* --- å…¨åŸŸæ¨£å¼ --- */
Â  Â  body {
Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  background-color: var(--main-bg-color);
Â  Â  Â  Â  color: #333;
Â  Â  }

Â  Â  .container {
Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  padding: 15px;
Â  Â  }

Â  Â  h1 {
Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  Â  color: var(--primary-color);
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .card {
Â  Â  Â  Â  background-color: var(--card-bg-color);
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  }

Â  Â  /* --- è¡¨å–®å…ƒç´ æ¨£å¼ --- */
Â  Â  label {
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  color: var(--view-color);
Â  Â  }

Â  Â  input[type="text"], input[type="datetime-local"], select, textarea {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  transition: border-color 0.3s;
Â  Â  }

Â  Â  input[type="text"]:focus, input[type="datetime-local"]:focus, select:focus, textarea:focus {
Â  Â  Â  Â  border-color: var(--primary-color);
Â  Â  Â  Â  outline: none;
Â  Â  }

Â  Â  textarea {
Â  Â  Â  Â  resize: vertical;
Â  Â  Â  Â  height: 80px;
Â  Â  }

Â  Â  /* --- æŒ‰éˆ•æ¨£å¼ --- */
Â  Â  button {
Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  transition: background-color 0.3s, transform 0.1s;
Â  Â  Â  Â  margin-right: 10px;
Â  Â  }

Â  Â  button:active {
Â  Â  Â  Â  transform: scale(0.98);
Â  Â  }
Â  Â  
Â  Â  .btn-primary {
Â  Â  Â  Â  background-color: var(--primary-color);
Â  Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-primary:hover {
Â  Â  Â  Â  background-color: #0056b3;
Â  Â  }

Â  Â  .btn-success {
Â  Â  Â  Â  background-color: var(--success-color);
Â  Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-success:hover {
Â  Â  Â  Â  background-color: #1e7e34;
Â  Â  }

Â  Â  .btn-danger {
Â  Â  Â  Â  background-color: var(--danger-color);
Â  Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-danger:hover {
Â  Â  Â  Â  background-color: #bd2130;
Â  Â  }
Â  Â  
Â  Â  .btn-secondary {
Â  Â  Â  Â  background-color: #6c757d;
Â  Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-secondary:hover {
Â  Â  Â  Â  background-color: #5a6268;
Â  Â  }

Â  Â  .btn-warning {
Â  Â  Â  Â  background-color: var(--copy-color);
Â  Â  Â  Â  color: var(--view-color);
Â  Â  }
Â  Â  .btn-warning:hover {
Â  Â  Â  Â  background-color: #e0a800;
Â  Â  }

Â  Â  /* --- åœ–ç‰‡é è¦½èˆ‡ä¸Šå‚³ --- */
Â  Â  .image-upload-area {
Â  Â  Â  Â  border: 2px dashed #ccc;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  background-color: #fafafa;
Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  height: 150px;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  }
Â  Â  .image-upload-area input[type="file"] {
Â  Â  Â  Â  display: none;
Â  Â  }
Â  Â  .placeholder {
Â  Â  Â  Â  color: #999;
Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  }
Â  Â  #preview-img {
Â  Â  Â  Â  max-width: 100%;
Â  Â  Â  Â  max-height: 100%;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  object-fit: contain;
Â  Â  Â  Â  display: none;
Â  Â  }

Â  Â  /* --- ç¸½åœæ­¢æ™‚é–“é¡¯ç¤º --- */
Â  Â  #total-stop-time {
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  color: var(--danger-color);
Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  padding: 5px;
Â  Â  Â  Â  border: 1px dashed var(--danger-color);
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  }

Â  Â  /* --- ç‹€æ…‹/éŒ¯èª¤è¨Šæ¯ Modal --- */
Â  Â  .modal {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  display: none; /* é è¨­éš±è— */
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  z-index: 1000;
Â  Â  }
Â  Â  .modal-content {
Â  Â  Â  Â  background-color: var(--card-bg-color);
Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  max-width: 80%;
Â  Â  Â  Â  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
Â  Â  }
Â  Â  .modal-icon {
Â  Â  Â  Â  font-size: 3rem;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  }
Â  Â  .modal-title {
Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  }
Â  Â  .modal-message {
Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  color: #666;
Â  Â  }
Â  Â  .loading .modal-icon { color: var(--primary-color); }
Â  Â  .success .modal-icon { color: var(--success-color); }
Â  Â  .error .modal-icon { color: var(--danger-color); }

Â  Â  /* --- ç™»å…¥èˆ‡è¨­å®šç•«é¢ --- */
Â  Â  .screen-full {
Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  background-color: var(--main-bg-color);
Â  Â  }
Â  Â  #login-screen .card {
Â  Â  Â  Â  min-width: 300px;
Â  Â  }
Â  Â  #settings-screen {
Â  Â  Â  Â  display: none;
Â  Â  Â  Â  padding-top: 40px;
Â  Â  Â  Â  padding-bottom: 40px;
Â  Â  Â  Â  background-color: var(--main-bg-color);
Â  Â  }

Â  Â  /* --- Header/Footer æ¨£å¼ --- */
Â  Â  header {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  background-color: var(--primary-color);
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
Â  Â  }
Â  Â  header h2 {
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  }
Â  Â  .header-icon-btn {
Â  Â  Â  Â  background: none;
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  padding: 5px;
Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  margin-right: 0;
Â  Â  }

Â  Â  .footer-btns {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  padding: 15px 0;
Â  Â  }
Â  Â  .footer-btns button {
Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  margin: 0 5px;
Â  Â  }
Â  Â  
Â  Â  /* --- æ–°å¢: è¿‘æœŸç´€éŒ„åˆ—è¡¨æ¨£å¼ --- */
Â  Â  .record-item {
Â  Â  Â  Â  padding: 8px 10px;
Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  border-bottom: 1px solid #eee;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  background-color: #fafafa;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  }
Â  Â  .record-item:hover {
Â  Â  Â  Â  background-color: #e6ffed; /* Hover æ™‚ç”¨ç¶ è‰²ç³» */
Â  Â  }
Â  Â  .record-title {
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  color: var(--view-color); /* é»‘è‰² */
Â  Â  }
Â  Â  .record-subtitle {
Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  font-size: 0.85em;
Â  Â  }
Â  Â  .record-time {
Â  Â  Â  Â  color: var(--copy-color); /* æ©˜è‰² */
Â  Â  Â  Â  font-size: 0.8em;
Â  Â  }
Â  Â  .section-title {
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  color: var(--primary-color);
Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  border-bottom: 2px solid #f0f0f0;
Â  Â  Â  Â  padding-bottom: 5px;
Â  Â  }
</style>
</head>
<body>

<div id="status-modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div id="modal-icon" class="modal-icon"></div>
Â  Â  Â  Â  <div id="modal-title" class="modal-title"></div>
Â  Â  Â  Â  <div id="modal-message" class="modal-message"></div>
Â  Â  Â  Â  <button id="modal-close-btn" class="btn-primary" style="margin-top: 20px; display: none;" onclick="closeStatusModal()">OK</button>
Â  Â  </div>
</div>

<div id="login-screen" class="screen-full">
Â  Â  <div class="card">
Â  Â  Â  Â  <h1 style="color: var(--success-color);">ç¶­ä¿®ç´€éŒ„ç³»çµ±</h1>
Â  Â  Â  Â  <p>è«‹è¼¸å…¥æ‚¨çš„å“¡å·¥ç·¨è™Ÿä»¥ç¹¼çºŒã€‚</p>
Â  Â  Â  Â  <input type="text" id="login-employee-id" placeholder="å“¡å·¥ç·¨è™Ÿ (ä¾‹å¦‚: A1234)" onkeypress="if(event.key === 'Enter') login()">
Â  Â  Â  Â  <button class="btn-success" onclick="login()">ç™»å…¥ / è¨­å®š</button>
Â  Â  </div>
</div>

<div id="app-screen" class="container" style="display: none;">
Â  Â  
Â  Â  <header>
Â  Â  Â  Â  <button class="header-icon-btn" onclick="openSettings()">âš™ï¸</button>
Â  Â  Â  Â  <h2>ç¶­ä¿®ç´€éŒ„è¡¨å–®</h2>
Â  Â  Â  Â  <button class="header-icon-btn" onclick="logout()">ğŸšª</button>
Â  Â  </header>

Â  Â  <div class="card">
Â  Â  Â  Â  <span class="section-title">1. åŸºæœ¬è³‡è¨Š</span>

Â  Â  Â  Â  <label for="input-employee-id">å“¡å·¥ç·¨è™Ÿ (ID)</label>
Â  Â  Â  Â  <input type="text" id="input-employee-id" placeholder="è‡ªå‹•è¼‰å…¥æˆ–æ‰‹å‹•è¼¸å…¥" required>

Â  Â  Â  Â  <label for="input-form-no">ç¶­ä¿®å–®è™Ÿ (Repair Form No.)</label>
Â  Â  Â  Â  <input type="text" id="input-form-no" placeholder="è«‹è¼¸å…¥å–®è™Ÿï¼Œç”¨æ–¼æ›´æ–°ç´€éŒ„" required>
Â  Â  Â  Â  
Â  Â  Â  Â  <label for="input-machine">æ©Ÿå°ç·¨è™Ÿ (Machine)</label>
Â  Â  Â  Â  <select id="input-machine" required>
Â  Â  Â  Â  Â  Â  <option value="">--- è«‹é¸æ“‡æ©Ÿå° ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  Â  <span class="section-title">2. ç¶­ä¿®æ™‚é–“èˆ‡åŸå› </span>

Â  Â  Â  Â  <div style="display: flex; gap: 10px;">
Â  Â  Â  Â  Â  Â  <div style="flex-grow: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="input-stop-time-full">åœæ©Ÿæ™‚é–“ (Stop Time)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="datetime-local" id="input-stop-time-full" onchange="calculateTotalStopTime()">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="flex-grow: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="input-start-time-full">é–‹æ©Ÿæ™‚é–“ (Start Time)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="datetime-local" id="input-start-time-full" onchange="calculateTotalStopTime()">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="total-stop-time">ç¸½åœæ©Ÿæ™‚é–“: 0 åˆ†é˜ (0.00 å°æ™‚)</div>
Â  Â  Â  Â  
Â  Â  Â  Â  <label for="input-concern-section">å•é¡Œéƒ¨é–€ (Concern Section)</label>
Â  Â  Â  Â  <select id="input-concern-section" required>
Â  Â  Â  Â  Â  Â  <option value="">--- è«‹é¸æ“‡å•é¡Œéƒ¨é–€ ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  <label for="input-reason">åœæ©ŸåŸå› /æ•…éšœæè¿° (Reason)</label>
Â  Â  Â  Â  <textarea id="input-reason" placeholder="è«‹ç°¡è¦æè¿°åœæ©ŸåŸå› æˆ–æ•…éšœæƒ…æ³" required></textarea>
Â  Â  </div>
Â  Â  
Â  Â  <div class="card">
Â  Â  Â  Â  <span class="section-title">3. è™•ç†çµæœèˆ‡ç…§ç‰‡</span>

Â  Â  Â  Â  <label for="input-solution">è§£æ±ºæ–¹æ¡ˆ (Solution)</label>
Â  Â  Â  Â  <textarea id="input-solution" placeholder="è«‹å¡«å¯«å¦‚ä½•è§£æ±ºå•é¡Œ"></textarea>

Â  Â  Â  Â  <label for="input-self-actions">è‡ªèº«è™•ç†å‹•ä½œ (Self Actions)</label>
Â  Â  Â  Â  <textarea id="input-self-actions" placeholder="è«‹è¨˜éŒ„ä½ è‡ªå·±åšäº†å“ªäº›å‹•ä½œ"></textarea>

Â  Â  Â  Â  <label>ä¸Šå‚³æ•…éšœç…§ç‰‡ (Image)</label>
Â  Â  Â  Â  <div class="image-upload-area" onclick="document.getElementById('file-input').click()">
Â  Â  Â  Â  Â  Â  <input type="file" id="file-input" accept="image/*" onchange="previewImage(event)">
Â  Â  Â  Â  Â  Â  <img id="preview-img" alt="Image Preview">
Â  Â  Â  Â  Â  Â  <div class="placeholder">é»æ“Šæˆ–æ‹–æ›³åœ–ç‰‡åˆ°æ­¤è™•</div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="card" id="recent-records-card" style="margin-top: 15px;">
Â  Â  Â  Â  <span class="section-title">4. Recent Records (è¿‘æœŸç´€éŒ„ - Last 10)</span>
Â  Â  Â  Â  <ul id="recent-records-list" style="list-style: none; padding: 0; margin: 0; font-size: 0.9em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li style="color: #999;">Loading recent records...</li>
Â  Â  Â  Â  </ul>
Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="footer-btns">
Â  Â  Â  Â  <button class="btn-primary" onclick="setCurrentTime('stop')" style="flex-basis: 30%;">â° Stop</button>
Â  Â  Â  Â  <button class="btn-success" onclick="setCurrentTime('start')" style="flex-basis: 30%;">âœ… Start</button>
Â  Â  Â  Â  <button class="btn-warning" onclick="clearForm()" style="flex-basis: 30%;">ğŸ—‘ï¸ Clear</button>
Â  Â  </div>

Â  Â  <button class="btn-danger" style="width: 100%; margin-bottom: 20px;" onclick="submitForm()">ğŸ’¾ Save to Cloud (å„²å­˜)</button>
</div>

<div id="settings-screen" class="container" style="display: none;">
Â  Â  <div class="card">
Â  Â  Â  Â  <h1>âš™ï¸ ç³»çµ±è¨­å®š</h1>
Â  Â  Â  Â  <p style="margin-top: -10px;">æ‚¨å¯ä»¥è‡ªè¨‚æ©Ÿå°åˆ—è¡¨ã€å•é¡Œéƒ¨é–€å’Œ Google Drive è³‡æ–™å¤¾ IDã€‚</p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  Â  <label for="setting-machine-list">æ©Ÿå°ç·¨è™Ÿåˆ—è¡¨ (æ¯è¡Œä¸€å€‹)</label>
Â  Â  Â  Â  <textarea id="setting-machine-list" rows="5">A1
A2
B1
B2</textarea>

Â  Â  Â  Â  <label for="setting-concern-section-list">å•é¡Œéƒ¨é–€åˆ—è¡¨ (æ¯è¡Œä¸€å€‹)</label>
Â  Â  Â  Â  <textarea id="setting-concern-section-list" rows="5">Electrical
Mechanical
IT
Operator</textarea>

Â  Â  Â  Â  <label for="setting-folder-id">Google Drive è³‡æ–™å¤¾ ID</label>
Â  Â  Â  Â  <input type="text" id="setting-folder-id" placeholder="å¯é¸ï¼Œç•™ç©ºå‰‡å­˜åˆ°æ ¹ç›®éŒ„">
Â  Â  </div>

Â  Â  <div class="footer-btns">
Â  Â  Â  Â  <button class="btn-primary" onclick="saveSettings()">å„²å­˜è¨­å®šä¸¦è¿”å›</button>
Â  Â  </div>
</div>


<script>
// ================= åƒæ•¸èˆ‡åˆå§‹åŒ– =================
const SCRIPT_URL = '<?= ScriptApp.getService().getUrl() ?>';
const FIXED_SCRIPT_ID = SCRIPT_URL.match(/d\/(.+)\/exec/)[1];
let processedImageBase64 = "";

window.onload = function() {
Â  Â  initApp();
};

// ================= ç•«é¢æ§åˆ¶åŠŸèƒ½ =================

function initApp() {
Â  Â  // å˜—è©¦å¾ localStorage è¼‰å…¥å“¡å·¥ç·¨è™Ÿå’Œè¨­å®š
Â  Â  const savedId = localStorage.getItem('employeeId');
Â  Â  const isLoggedIn = localStorage.getItem("isLoggedIn");
Â  Â  
Â  Â  if (savedId) {
Â  Â  Â  Â  document.getElementById('login-employee-id').value = savedId;
Â  Â  Â  Â  document.getElementById('input-employee-id').value = savedId;
Â  Â  }
Â  Â  
Â  Â  if(isLoggedIn === "true") {
Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'none';
Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  Â  Â  applySettings();
Â  Â  Â  Â  loadRecentRecords(); // <<< [æ–°å¢] è¼‰å…¥æœ€è¿‘ç´€éŒ„
Â  Â  } else {
Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'flex';
Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'none';
Â  Â  }
}

function login() {
Â  Â  const employeeId = document.getElementById('login-employee-id').value.trim();
Â  Â  if (!employeeId) {
Â  Â  Â  Â  alert("è«‹è¼¸å…¥å“¡å·¥ç·¨è™Ÿï¼");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  localStorage.setItem('employeeId', employeeId);
Â  Â  localStorage.setItem('isLoggedIn', 'true');
Â  Â  
Â  Â  document.getElementById('input-employee-id').value = employeeId;
Â  Â  document.getElementById('login-screen').style.display = 'none';
Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  applySettings();
Â  Â  loadRecentRecords(); // <<< [æ–°å¢] è¼‰å…¥æœ€è¿‘ç´€éŒ„
}

function logout() {
Â  Â  if (confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
Â  Â  Â  Â  localStorage.removeItem('isLoggedIn');
Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'none';
Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'flex';
Â  Â  Â  Â  document.getElementById('settings-screen').style.display = 'none';
Â  Â  Â  Â  clearForm();
Â  Â  }
}

function openSettings() {
Â  Â  document.getElementById('app-screen').style.display = 'none';
Â  Â  document.getElementById('settings-screen').style.display = 'block';
Â  Â  
Â  Â  // è¼‰å…¥å„²å­˜çš„è¨­å®šå€¼
Â  Â  document.getElementById('setting-machine-list').value = localStorage.getItem('machineList') || "A1\nA2";
Â  Â  document.getElementById('setting-concern-section-list').value = localStorage.getItem('concernSectionList') || "Electrical\nMechanical";
Â  Â  document.getElementById('setting-folder-id').value = localStorage.getItem('folderId') || "";
}

function saveSettings() {
Â  Â  localStorage.setItem('machineList', document.getElementById('setting-machine-list').value.trim());
Â  Â  localStorage.setItem('concernSectionList', document.getElementById('setting-concern-section-list').value.trim());
Â  Â  localStorage.setItem('folderId', document.getElementById('setting-folder-id').value.trim());
Â  Â  
Â  Â  alert("è¨­å®šå·²å„²å­˜ï¼");
Â  Â  
Â  Â  document.getElementById('settings-screen').style.display = 'none';
Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  
Â  Â  applySettings(); // é‡æ–°å¥—ç”¨è¨­å®šåˆ°è¡¨å–®
}

function applySettings() {
Â  Â  // æ‡‰ç”¨æ©Ÿå°åˆ—è¡¨
Â  Â  const machineList = localStorage.getItem('machineList') || "A1\nA2";
Â  Â  populateSelect('input-machine', machineList);

Â  Â  // æ‡‰ç”¨å•é¡Œéƒ¨é–€åˆ—è¡¨
Â  Â  const concernList = localStorage.getItem('concernSectionList') || "Electrical\nMechanical";
Â  Â  populateSelect('input-concern-section', concernList);
}

function populateSelect(selectId, listString) {
Â  Â  const select = document.getElementById(selectId);
Â  Â  const defaultOption = select.options[0];
Â  Â  
Â  Â  // æ¸…ç©ºèˆŠçš„ Options (ä¿ç•™ç¬¬ä¸€å€‹é è¨­é¸é …)
Â  Â  while (select.options.length > 1) {
Â  Â  Â  Â  select.remove(1);
Â  Â  }
Â  Â  
Â  Â  const items = listString.split('\n').map(item => item.trim()).filter(item => item !== "");
Â  Â  
Â  Â  items.forEach(item => {
Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  option.value = item;
Â  Â  Â  Â  option.textContent = item;
Â  Â  Â  Â  select.appendChild(option);
Â  Â  });
}

// ================= åœ–ç‰‡è™•ç†åŠŸèƒ½ =================

function previewImage(event) {
Â  Â  const file = event.target.files[0];
Â  Â  const preview = document.getElementById('preview-img');
Â  Â  const placeholder = document.querySelector('.placeholder');
Â  Â  
Â  Â  if (file) {
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = function(e) {
Â  Â  Â  Â  Â  Â  preview.src = e.target.result;
Â  Â  Â  Â  Â  Â  preview.style.display = 'block';
Â  Â  Â  Â  Â  Â  placeholder.style.display = 'none';
Â  Â  Â  Â  Â  Â  processedImageBase64 = e.target.result; // å„²å­˜ Base64 æ•¸æ“š
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  } else {
Â  Â  Â  Â  preview.style.display = 'none';
Â  Â  Â  Â  placeholder.style.display = 'block';
Â  Â  Â  Â  processedImageBase64 = "";
Â  Â  }
}

// ================= æ™‚é–“èˆ‡è¨ˆç®—åŠŸèƒ½ =================

/**
 * å°‡ Date ç‰©ä»¶æ ¼å¼åŒ–ç‚º yyyy-MM-ddTHH:mm (datetime-local æ ¼å¼)
 */
function formatDateTimeLocal(date) {
Â  Â  if (!date) return "";
Â  Â  const year = date.getFullYear();
Â  Â  const month = String(date.getMonth() + 1).padStart(2, '0');
Â  Â  const day = String(date.getDate()).padStart(2, '0');
Â  Â  const hour = String(date.getHours()).padStart(2, '0');
Â  Â  const minute = String(date.getMinutes()).padStart(2, '0');
Â  Â  return `${year}-${month}-${day}T${hour}:${minute}`;
}

/**
 * è¨­ç½® Stop Time æˆ– Start Time ç‚ºç•¶å‰æ™‚é–“
 */
function setCurrentTime(type) {
Â  Â  const now = new Date();
Â  Â  const formattedTime = formatDateTimeLocal(now);
Â  Â  
Â  Â  if (type === 'stop') {
Â  Â  Â  Â  document.getElementById('input-stop-time-full').value = formattedTime;
Â  Â  } else if (type === 'start') {
Â  Â  Â  Â  document.getElementById('input-start-time-full').value = formattedTime;
Â  Â  }
Â  Â  calculateTotalStopTime();
}

/**
 * è¨ˆç®—ä¸¦é¡¯ç¤ºç¸½åœæ©Ÿæ™‚é–“
 */
function calculateTotalStopTime() {
Â  Â  const stopTimeStr = document.getElementById('input-stop-time-full').value;
Â  Â  const startTimeStr = document.getElementById('input-start-time-full').value;
Â  Â  const totalTimeDisplay = document.getElementById('total-stop-time');
Â  Â  
Â  Â  if (!stopTimeStr || !startTimeStr) {
Â  Â  Â  Â  totalTimeDisplay.textContent = "ç¸½åœæ©Ÿæ™‚é–“: 0 åˆ†é˜ (0.00 å°æ™‚)";
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  const stopTime = new Date(stopTimeStr);
Â  Â  const startTime = new Date(startTimeStr);
Â  Â  
Â  Â  if (isNaN(stopTime.getTime()) || isNaN(startTime.getTime())) {
Â  Â  Â  Â  totalTimeDisplay.textContent = "ç¸½åœæ©Ÿæ™‚é–“: (æ™‚é–“æ ¼å¼éŒ¯èª¤)";
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // æª¢æŸ¥ Start Time æ˜¯å¦æ™šæ–¼ Stop Time
Â  Â  if (startTime.getTime() <= stopTime.getTime()) {
Â  Â  Â  Â  totalTimeDisplay.textContent = "ç¸½åœæ©Ÿæ™‚é–“: 0 åˆ†é˜ (0.00 å°æ™‚) - æ™‚é–“ç„¡æ•ˆ";
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  const diffMs = startTime.getTime() - stopTime.getTime();
Â  Â  const diffMinutes = Math.round(diffMs / (1000 * 60));
Â  Â  const diffHours = (diffMinutes / 60).toFixed(2);
Â  Â  
Â  Â  totalTimeDisplay.textContent = `ç¸½åœæ©Ÿæ™‚é–“: ${diffMinutes} åˆ†é˜ (${diffHours} å°æ™‚)`;
}

// ================= è¡¨å–®æäº¤èˆ‡æ¸…é™¤åŠŸèƒ½ =================

function clearForm() {
Â  Â  document.getElementById('input-form-no').value = '';
Â  Â  document.getElementById('input-machine').value = '';
Â  Â  document.getElementById('input-stop-time-full').value = '';
Â  Â  document.getElementById('input-start-time-full').value = '';
Â  Â  document.getElementById('input-concern-section').value = '';
Â  Â  document.getElementById('input-reason').value = '';
Â  Â  document.getElementById('input-solution').value = '';
Â  Â  document.getElementById('input-self-actions').value = '';
Â  Â  
Â  Â  // æ¸…é™¤åœ–ç‰‡é è¦½
Â  Â  processedImageBase64 = "";
Â  Â  document.getElementById('file-input').value = null; // æ¸…é™¤æª”æ¡ˆé¸æ“‡
Â  Â  document.getElementById('preview-img').style.display = 'none';
Â  Â  document.getElementById('preview-img').src = '';
Â  Â  document.querySelector('.placeholder').style.display = 'block';

Â  Â  calculateTotalStopTime();
Â  Â  alert("è¡¨å–®å·²æ¸…ç©ºã€‚");
}

function submitForm() {
Â  Â  const employeeId = document.getElementById('input-employee-id').value.trim();
Â  Â  const formNo = document.getElementById('input-form-no').value.trim();
Â  Â  const machine = document.getElementById('input-machine').value;
Â  Â  const stopTimeFull = document.getElementById('input-stop-time-full').value;
Â  Â  const startTimeFull = document.getElementById('input-start-time-full').value;
Â  Â  const concernSection = document.getElementById('input-concern-section').value;
Â  Â  const reason = document.getElementById('input-reason').value.trim();
Â  Â  const solution = document.getElementById('input-solution').value.trim();
Â  Â  const selfActions = document.getElementById('input-self-actions').value.trim();
Â  Â  const folderId = localStorage.getItem('folderId') || "";
Â  Â  
Â  Â  // åŸºæœ¬é©—è­‰
Â  Â  if (!employeeId || !machine || !reason) {
Â  Â  Â  Â  alert("è«‹æª¢æŸ¥ï¼šå“¡å·¥ç·¨è™Ÿã€æ©Ÿå°ç·¨è™Ÿã€åœæ©ŸåŸå› /æ•…éšœæè¿° ç‚ºå¿…å¡«æ¬„ä½ã€‚");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  if (!stopTimeFull && !startTimeFull && !formNo) {
Â  Â  Â  Â  alert("è«‹è‡³å°‘æä¾› Repair Form No. æˆ– Stop/Start Timeã€‚");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // æª¢æŸ¥æ˜¯å¦ç‚ºæ›´æ–°æ¨¡å¼ï¼Œä½†å»æ²’æœ‰æ›´æ–°ä»»ä½•æ±è¥¿
Â  Â  if (formNo && !stopTimeFull && !startTimeFull && !solution && !selfActions && !processedImageBase64) {
Â  Â  Â  Â  alert("æ‚¨æ­£åœ¨ä½¿ç”¨å–®è™Ÿæ›´æ–°æ¨¡å¼ï¼Œä½†æ²’æœ‰å¡«å¯«ä»»ä½•è¦æ›´æ–°çš„è³‡è¨Š (Solution/Self Actions/æ™‚é–“/ç…§ç‰‡)ã€‚è«‹æª¢æŸ¥ã€‚");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // æ§‹å»ºæ•¸æ“šç‰©ä»¶
Â  Â  const data = {
Â  Â  Â  Â  employeeId: employeeId,
Â  Â  Â  Â  formNo: formNo,
Â  Â  Â  Â  machine: machine,
Â  Â  Â  Â  stopTimeFull: stopTimeFull,
Â  Â  Â  Â  startTimeFull: startTimeFull,
Â  Â  Â  Â  concernSection: concernSection,
Â  Â  Â  Â  reason: reason,
Â  Â  Â  Â  solution: solution,
Â  Â  Â  Â  selfActions: selfActions,
Â  Â  Â  Â  image: processedImageBase64, // Base64 æ•¸æ“š
Â  Â  Â  Â  folderId: folderId
Â  Â  };
Â  Â  
Â  Â  showStatus('loading', 'Uploading...', 'æ­£åœ¨ä¸Šå‚³æ•¸æ“šä¸­ï¼Œè«‹ç¨å€™...');

Â  Â  // POST è«‹æ±‚
Â  Â  fetch(SCRIPT_URL, {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/x-www-form-urlencoded'
Â  Â  Â  Â  },
Â  Â  Â  Â  body: JSON.stringify(data)
Â  Â  })
Â  Â  .then(response => response.json())
Â  Â  .then(res => {
Â  Â  Â  Â  if (res.result === "success") {
Â  Â  Â  Â  Â  Â  showStatus('success', 'Upload Successful', `æ“ä½œæˆåŠŸï¼å‹•ä½œ: ${res.action}ã€‚è¡Œè™Ÿ: ${res.rowIndex}`);
Â  Â  Â  Â  Â  Â  clearForm();
Â  Â  Â  Â  Â  Â  loadRecentRecords(); // æˆåŠŸå¾Œæ›´æ–°åˆ—è¡¨
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showStatus('error', 'Upload Failed', `ä¼ºæœå™¨éŒ¯èª¤: ${res.error}`);
Â  Â  Â  Â  }
Â  Â  })
Â  Â  .catch(error => {
Â  Â  Â  Â  console.error('Error submitting form:', error);
Â  Â  Â  Â  showStatus('error', 'Network Error', 'ç¶²è·¯é€£ç·šå¤±æ•—æˆ–ä¼ºæœå™¨ç„¡å›æ‡‰ã€‚');
Â  Â  })
Â  Â  .finally(() => {
Â  Â  Â  Â  // å»¶é²é—œé–‰ Modalï¼Œè®“ç”¨æˆ¶çœ‹åˆ°æˆåŠŸè¨Šæ¯
Â  Â  Â  Â  setTimeout(() => { closeStatusModal(); }, 1500);
Â  Â  });
}

// ================= ç‹€æ…‹ Modal æ§åˆ¶ =================

function showStatus(type, title, message) {
Â  Â  const modal = document.getElementById('status-modal');
Â  Â  const icon = document.getElementById('modal-icon');
Â  Â  
Â  Â  modal.className = 'modal ' + type;
Â  Â  
Â  Â  if (type === 'loading') {
Â  Â  Â  Â  icon.innerHTML = 'ğŸ”„';
Â  Â  Â  Â  document.getElementById('modal-close-btn').style.display = 'none';
Â  Â  } else if (type === 'success') {
Â  Â  Â  Â  icon.innerHTML = 'âœ…';
Â  Â  Â  Â  document.getElementById('modal-close-btn').style.display = 'block';
Â  Â  } else if (type === 'error') {
Â  Â  Â  Â  icon.innerHTML = 'âŒ';
Â  Â  Â  Â  document.getElementById('modal-close-btn').style.display = 'block';
Â  Â  }
Â  Â  
Â  Â  document.getElementById('modal-title').textContent = title;
Â  Â  document.getElementById('modal-message').textContent = message;
Â  Â  modal.style.display = 'flex';
}

function closeStatusModal() {
Â  Â  document.getElementById('status-modal').style.display = 'none';
}


// ================= ç´€éŒ„è®€å–èˆ‡è¡¨å–®å¡«å…¥åŠŸèƒ½ (æ–°å¢çš„é‚è¼¯) =================

/**
 * è¼‰å…¥æœ€è¿‘çš„ç´€éŒ„ä¸¦æ¸²æŸ“åˆ°åˆ—è¡¨ä¸­
 */
function loadRecentRecords() {
Â  Â  const listContainer = document.getElementById('recent-records-list');
Â  Â  // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨ FIXED_SCRIPT_ID ç¹é GAS éƒ¨ç½²å¿«å–
Â  Â  const scriptUrl = `https://script.google.com/macros/s/${FIXED_SCRIPT_ID}/exec?action=loadRecords`;
Â  Â  
Â  Â  listContainer.innerHTML = '<li style="color: #999;">Loading...</li>';

Â  Â  fetch(scriptUrl)
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (res.result === 'success' && res.data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  res.data.forEach(record => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = 'record-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.setAttribute('data-form-no', record.formNo);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // é»æ“Šäº‹ä»¶ï¼šå‘¼å« fillForm å‡½æ•¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.onclick = () => fillForm(record.formNo);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const totalTimeDisplay = record.totalTime && record.totalTime > 0 ? 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` (${record.totalTime} min / ${(record.totalTime / 60).toFixed(2)} hr)` : 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="record-title">#${record.formNo} - ${record.machine}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="record-subtitle">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Concern: ${record.concernSection} | Reason: ${record.reason.substring(0, 30)}...
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="record-time">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Stop: ${record.stopTime} | Start: ${record.startTime} ${totalTimeDisplay}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listContainer.appendChild(listItem);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '<li style="color: #999;">No recent records found.</li>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {
Â  Â  Â  Â  Â  Â  console.error("Failed to load recent records:", e);
Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '<li style="color: red;">âŒ Failed to load data.</li>';
Â  Â  Â  Â  });
}


/**
 * æ ¹æ“š Form No ç²å–å–®ä¸€è³‡æ–™ä¸¦å¡«å…¥è¡¨å–®
 * @param {string} formNo - è¦è¼‰å…¥çš„ Repair Form No
 */
function fillForm(formNo) {
Â  Â  if (!formNo) return;
Â  Â  
Â  Â  if(!confirm(`ç¢ºå®šè¦è¼‰å…¥ Form No: ${formNo} çš„ç´€éŒ„ä¾†è£œå……æˆ–ä¿®æ”¹å—ï¼Ÿ\n(é€™æœƒè¦†è“‹ç•¶å‰è¡¨å–®å…§å®¹)`)) {
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨ FIXED_SCRIPT_ID ç¹é GAS éƒ¨ç½²å¿«å–
Â  Â  const scriptUrl = `https://script.google.com/macros/s/${FIXED_SCRIPT_ID}/exec?action=getRow&formNo=${encodeURIComponent(formNo)}`;
Â  Â  showStatus('loading', 'Loading Record...', `è¼‰å…¥ ${formNo} ç´€éŒ„ä¸­...`);

Â  Â  fetch(scriptUrl)
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  if (res.result === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  handleRecordLoad(res.data);
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('success', 'Load Complete', `ç´€éŒ„ ${formNo} å·²è¼‰å…¥è¡¨å–®ï¼`);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('error', 'Load Failed', `è¼‰å…¥å¤±æ•—ï¼š${res.error}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {
Â  Â  Â  Â  Â  Â  console.error("Load failed:", e);
Â  Â  Â  Â  Â  Â  showStatus('error', 'Load Failed', 'ç¶²è·¯æˆ–ä¼ºæœå™¨éŒ¯èª¤ï¼Œç„¡æ³•è¼‰å…¥è³‡æ–™ã€‚');
Â  Â  Â  Â  })
Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  // å»¶é²é—œé–‰ Modalï¼Œè®“ç”¨æˆ¶çœ‹åˆ°æˆåŠŸè¨Šæ¯
Â  Â  Â  Â  Â  Â  setTimeout(() => { closeStatusModal(); }, 1500); 
Â  Â  Â  Â  });
}


/**
 * å°‡å¾ GAS ç²å–çš„å–®ä¸€ç´€éŒ„æ•¸æ“šå¡«å…¥ä¸»è¡¨å–®
 * @param {object} data - å¾ doGetRow ç²å–çš„ç´€éŒ„ç‰©ä»¶
 */
function handleRecordLoad(data) {
Â  Â  // 1. å¡«å…¥æ‰€æœ‰æ–‡å­—æ¬„ä½
Â  Â  document.getElementById('input-employee-id').value = data.employeeId || "";
Â  Â  document.getElementById('input-form-no').value = data.formNo || "";
Â  Â  document.getElementById('input-reason').value = data.reason || "";
Â  Â  document.getElementById('input-solution').value = data.solution || "";
Â  Â  document.getElementById('input-self-actions').value = data.selfActions || "";

Â  Â  // 2. å¡«å…¥ Select é¸å–® (æ©Ÿå° & éƒ¨é–€)
Â  Â  document.getElementById('input-machine').value = data.machine || "";
Â  Â  document.getElementById('input-concern-section').value = data.concernSection || "";

Â  Â  // 3. å¡«å…¥æ™‚é–“æ¬„ä½ (éœ€å¾ DD/MM/YYYY hh:mm è½‰æ›ç‚º datetime-local æ ¼å¼)
Â  Â  // æ³¨æ„ï¼šç”±æ–¼å‰ç«¯çš„ <input type="datetime-local"> éœ€è¦ 'YYYY-MM-DDThh:mm' æ ¼å¼ï¼Œ
Â  Â  // è€Œå¾Œç«¯ doGetRow è¿”å›çš„æ˜¯ 'DD/MM/YYYY hh:mm'ï¼Œéœ€è¦é€²è¡Œè½‰æ›ã€‚
Â  Â  function convertToDateTimeLocal(dateStr) {
Â  Â  Â  Â  if (!dateStr) return "";
Â  Â  Â  Â  // åŒ¹é… DD/MM/YYYY hh:mm
Â  Â  Â  Â  const match = dateStr.match(/^(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2})$/);
Â  Â  Â  Â  if (match) {
Â  Â  Â  Â  Â  Â  // è½‰æ›ç‚º YYYY-MM-DDT HH:mm
Â  Â  Â  Â  Â  Â  return `${match[3]}-${match[2]}-${match[1]}T${match[4]}:${match[5]}`;
Â  Â  Â  Â  }
Â  Â  Â  Â  return "";
Â  Â  }

Â  Â  document.getElementById('input-stop-time-full').value = convertToDateTimeLocal(data.stopTimeFull);
Â  Â  document.getElementById('input-start-time-full').value = convertToDateTimeLocal(data.startTimeFull);
Â  Â  
Â  Â  // 4. é‡æ–°è¨ˆç®— Total Time
Â  Â  calculateTotalStopTime();
Â  Â  
Â  Â  // 5. æ¸…é™¤åœ–ç‰‡é è¦½ï¼ˆåœ–ç‰‡ Base64 ç„¡æ³•å¾ Apps Script åå‘è¼‰å…¥ï¼‰
Â  Â  processedImageBase64 = "";
Â  Â  const preview = document.getElementById('preview-img');
Â  Â  preview.style.display = 'none';
Â  Â  preview.src = "";
Â  Â  document.getElementById('file-input').value = null; 
Â  Â  document.querySelector('.placeholder').style.display = 'block';

Â  Â  // æç¤ºä½¿ç”¨è€…
Â  Â  alert(`ç´€éŒ„ #${data.formNo} å·²æˆåŠŸè¼‰å…¥ï¼\næ‚¨å¯ä»¥è£œå…… Solution / Self Actions / æ™‚é–“ / åœ–ç‰‡ï¼Œç„¶å¾Œé»æ“Š [Save to Cloud] é€²è¡Œæ›´æ–°ã€‚`);
}
</script>
</body>
</html>
