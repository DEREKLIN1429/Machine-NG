<!DOCTYPE html>
<html>
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Machine-NG (é‡é»äº‹é …ç´€éŒ„)</title>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  /* ä¸»é«”é…è‰²ï¼šé»‘ã€æ©˜ã€ç¶  */
Â  Â  Â  Â  Â  Â  --primary-color: #4CAF50; /* ç¶ è‰² - ä¸»è¦/æˆåŠŸ/å„²å­˜ */
Â  Â  Â  Â  Â  Â  --bg-color: #f7f9fc;Â 
Â  Â  Â  Â  Â  Â  --card-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --danger-color: #e53935;Â 
Â  Â  Â  Â  Â  Â  --copy-color: #FF9800; /* æ©˜è‰² - Copy/Drive */
Â  Â  Â  Â  Â  Â  --view-color: #212121; /* é»‘è‰² - View/æ¬¡è¦ */
Â  Â  Â  Â  Â  Â  --frame-color: #4CAF50;Â 
Â  Â  Â  Â  Â  Â  --input-border: #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);Â 
Â  Â  Â  Â  Â  Â  margin: 0; padding: 0;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; min-height: 100vh;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- æ¨¡çµ„åŒ–æ¨£å¼ --- */
Â  Â  Â  Â  #login-screen, #status-modal, #settings-modal {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.6); z-index: 9999;
Â  Â  Â  Â  Â  Â  display: none; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  #login-screen { background: var(--bg-color); }

Â  Â  Â  Â  .modal-box {
Â  Â  Â  Â  Â  Â  background: white; padding: 25px; border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 450px;
Â  Â  Â  Â  Â  Â  max-height: 90vh;Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .login-input {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px; font-size: 16px; text-align: left;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  .spinner {
Â  Â  Â  Â  Â  Â  border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
Â  Â  Â  Â  Â  Â  border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite;
Â  Â  Â  Â  Â  Â  margin: 0 auto 15px auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #app-screen { width: 100%; max-width: 500px; padding: 10px; box-sizing: border-box; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
Â  Â  Â  Â  .header-btn {Â 
Â  Â  Â  Â  Â  Â  font-size: 24px;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer; color: #555; padding: 6px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50%; transition: background 0.2s;
Â  Â  Â  Â  Â  Â  width: 36px; height: 36px;Â 
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-title h2 { margin: 0; color: #333; font-size: 1.2rem; line-height: 1.4; }

Â  Â  Â  Â  .card { background: var(--card-bg); padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 12px; }
Â  Â  Â  Â  .section-title { font-weight: bold; color: #555; margin-bottom: 8px; display: block; font-size: 1rem; }

Â  Â  Â  Â  .photo-controls { display: flex; gap: 10px; margin-bottom: 10px; }
Â  Â  Â  Â  .btn-half { flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 5px;}
Â  Â  Â  Â  .btn-cam { background-color: #FF5722; color: white; }Â 
Â  Â  Â  Â  .btn-gallery { background-color: #FFC107; color: #333; }Â 

Â  Â  Â  Â  /* --- åœ–ç‰‡é è¦½ (ä¿æŒä¿®æ­£) --- */
Â  Â  Â  Â  #preview-container { max-width: 100%; height: auto; }
Â  Â  Â  Â  #preview-img { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; }

Â  Â  Â  Â  /* --- è¼¸å…¥/è¡¨å–®æ¨£å¼ (ä¿æŒä¸è®Š) --- */
Â  Â  Â  Â  .input-group { margin-bottom: 8px; display: flex; flex-direction: column; }
Â  Â  Â  Â  .input-label { font-weight: bold; font-size: 0.9rem; color: #333; margin-bottom: 4px; }
Â  Â  Â  Â  .text-input, textarea, select.text-input {Â 
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; border: 1px solid var(--input-border);Â 
Â  Â  Â  Â  Â  Â  border-radius: 6px; font-size: 15px; box-sizing: border-box;
Â  Â  Â  Â  Â  Â  font-family: inherit; transition: border-color 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  textarea { height: 80px; resize: vertical; }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  .time-component { display: flex; flex-direction: column; margin-bottom: 8px; }
Â  Â  Â  Â  .time-input-row { display: flex; align-items: center; gap: 5px; }
Â  Â  Â  Â  
Â  Â  Â  Â  /* æ–°å¢èªéŸ³æŒ‰éˆ•æ¨£å¼ */
Â  Â  Â  Â  .btn-voice {
Â  Â  Â  Â  Â  Â  background-color: #3f51b5; /* è—è‰² */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 8px 12px;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-voice.recording {
Â  Â  Â  Â  Â  Â  background-color: var(--danger-color); /* éŒ„éŸ³ä¸­è®Šæˆç´…è‰² */
Â  Â  Â  Â  Â  Â  animation: pulse 1s infinite alternate; /* å¢åŠ é–ƒçˆæ•ˆæœ */
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes pulse {
Â  Â  Â  Â  Â  Â  from { box-shadow: 0 0 0 0 rgba(229, 57, 53, 0.7); }
Â  Â  Â  Â  Â  Â  to { box-shadow: 0 0 0 10px rgba(229, 57, 53, 0); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .voice-control-group {
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- åº•éƒ¨æŒ‰éˆ•ç¾å­¸å„ªåŒ– (ä¿æŒä¸è®Š) --- */
Â  Â  Â  Â  .footer-btns { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; padding-bottom: 20px;}
Â  Â  Â  Â  .btn-main {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 14px 15px;Â 
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  font-size: 16px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  transition: background 0.2s, transform 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-main:active { transform: scale(0.99); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-copy { background-color: var(--copy-color); }Â 
Â  Â  Â  Â  .btn-save { background-color: var(--primary-color); }Â 
Â  Â  Â  Â  .btn-view { background-color: var(--view-color); color: white; }Â 
Â  Â  Â  Â  .btn-drive { background-color: var(--copy-color); }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- è¨­å®šå…§æ’ç‰ˆä¿®æ­£ (ä¿æŒä¸è®Š) --- */
Â  Â  Â  Â  #machine-list-container, #concern-section-list-container {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(3, 1fr);Â 
Â  Â  Â  Â  Â  Â  gap: 5px;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .machine-list-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 6px;
Â  Â  Â  Â  Â  Â  background: #f1f1f1;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  Â  Â  word-break: break-all;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-remove-item {
Â  Â  Â  Â  Â  Â  background: var(--danger-color);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 2px 5px;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-top: 3px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .hidden { display: none !important; }
Â  Â  Â  Â  
Â  Â  Â  Â  /* --- æ–°å¢: è¿‘æœŸç´€éŒ„åˆ—è¡¨æ¨£å¼ --- */
Â  Â  Â  Â  .record-item {
Â  Â  Â  Â  Â  Â  padding: 8px 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #eee;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  background-color: #fafafa;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .record-item:hover {
Â  Â  Â  Â  Â  Â  background-color: #e6ffed; /* Hover æ™‚ç”¨ç¶ è‰²ç³» */
Â  Â  Â  Â  }
Â  Â  Â  Â  .record-title {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--view-color); /* é»‘è‰² */
Â  Â  Â  Â  }
Â  Â  Â  Â  .record-subtitle {
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  font-size: 0.85em;
Â  Â  Â  Â  }
Â  Â  Â  Â  .record-time {
Â  Â  Â  Â  Â  Â  color: var(--copy-color); /* æ©˜è‰² */
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="login-screen" style="display: none;">
Â  Â  Â  Â  <div class="modal-box">
Â  Â  Â  Â  Â  Â  <h3>ğŸ”’ Login (ç™»å…¥)</h3>
Â  Â  Â  Â  Â  Â  <p style="color:#666; font-size:0.9em;">Default Password: 12345<br>(è«‹è¼¸å…¥å¯†ç¢¼)</p>
Â  Â  Â  Â  Â  Â  <input type="password" id="loginPass" class="login-input" placeholder="Password">
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" onclick="checkLogin()">Login (é€²å…¥)</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="status-modal" style="display: none;">
Â  Â  Â  Â  <div class="modal-box">
Â  Â  Â  Â  Â  Â  <div id="status-spinner" class="spinner"></div>
Â  Â  Â  Â  Â  Â  <div id="status-icon" class="status-icon" style="display:none; font-size: 40px;"></div>
Â  Â  Â  Â  Â  Â  <h3 id="status-text" style="color:#333; margin:0;">Uploading...</h3>
Â  Â  Â  Â  Â  Â  <p id="status-subtext" style="color:#666; font-size:0.9em; margin-top:5px;">(è³‡æ–™ä¸Šå‚³ä¸­...)</p>
Â  Â  Â  Â  Â  Â  <button id="status-close-btn" onclick="closeStatusModal()" class="btn-main btn-view" style="margin-top: 15px; display: none;">OK</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="app-screen" style="display: none;">
Â  Â  Â  Â  <div class="author-header">Author: DERER LIN (v3.7)</div>

Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <div class="header-btn" onclick="logout()" title="Lock / Logout (é–å®š/ç™»å‡º)">ğŸ”’</div>
Â  Â  Â  Â  Â  Â  <div class="header-title">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Machine-NG<br>é‡é»äº‹é …ç´€éŒ„</h2>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="header-btn" onclick="openSettings()" title="Settings (è¨­å®š)">âš™ï¸</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-employee-id">Employee ID (å“¡å·¥ç·¨è™Ÿ):</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="input-employee-id" class="text-input" placeholder="å„²å­˜å¾Œä¸æœƒæ¸…é™¤">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <span class="section-title">1. Photo (åœ–ç‰‡ç´€éŒ„)</span>
Â  Â  Â  Â  Â  Â  <div class="photo-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-cam" onclick="triggerFile('input-cam')">ğŸ“· Camera</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-gallery" onclick="triggerFile('input-gallery')">ğŸ–¼ï¸ Gallery</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="preview-container" class="ratio-4-3" onclick="triggerFile('input-cam')" title="Click to take photo">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="ratio-tag" id="ratio-display-tag">Ratio: 4:3</div>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="placeholder">Tap here to Take Photo</span>
Â  Â  Â  Â  Â  Â  Â  Â  <img id="preview-img">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <input type="file" id="input-cam" accept="image/*" capture="environment" class="hidden" onchange="handleFile(this)">
Â  Â  Â  Â  Â  Â  <input type="file" id="input-gallery" accept="image/*" class="hidden" onchange="handleFile(this)">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card" id="info-card">
Â  Â  Â  Â  Â  Â  <span class="section-title" id="machine-info-title">2. Machine NG Information</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-machine">Machine :</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="input-machine" class="text-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-form-no">Repair Form No:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-form-no" class="text-input" placeholder="e.g. A69304">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="time-component">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-stop-time-full">Stop time : (DD/MM/YYYY hh:mm)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-input-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-stop-time-full" class="text-input"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="è«‹é»å³å´æŒ‰éˆ•æˆ–æ‰‹å‹•è¼¸å…¥" oninput="calculateTotalStopTime()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-update-time"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="updateSingleTime('input-stop-time-full')" title="Set Current Time">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 1.1em;">â±ï¸</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="time-component">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-start-time-full">Start time : (DD/MM/YYYY hh:mm)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-input-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-start-time-full" class="text-input"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="è«‹é»å³å´æŒ‰éˆ•æˆ–æ‰‹å‹•è¼¸å…¥" oninput="calculateTotalStopTime()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-update-time"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="updateSingleTime('input-start-time-full')" title="Set Current Time">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 1.1em;">â±ï¸</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-total-time">Total stop time : (è‡ªå‹•è¨ˆç®—)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="total-time-input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-total-time" class="text-input" placeholder="" readonly style="background-color: #eee; font-weight: bold;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="total-time-unit" onchange="calculateTotalStopTime()" class="text-input" style="width: auto;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="h">hr (å°æ™‚)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="min">min (åˆ†é˜)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-concern-section">Concern Section :</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="input-concern-section" class="text-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-reason">Reason :</label>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="input-reason" placeholder="e.g. dischrge door not open"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="voice-control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-voice" data-target="input-reason" onclick="toggleVoice(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¤ èªéŸ³è¼¸å…¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 0.8em; color: #666;"> (éœé»˜ 1.5 ç§’è‡ªå‹•åœæ­¢)</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-solution">How to Solve Problem:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="input-solution" placeholder="e.g. hydraulic pressure set"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="voice-control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-voice" data-target="input-solution" onclick="toggleVoice(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¤ èªéŸ³è¼¸å…¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label" for="input-self-actions">Self Actions:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="input-self-actions" placeholder="e.g. check and inform maintenance team"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="voice-control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-voice" data-target="input-self-actions" onclick="toggleVoice(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¤ èªéŸ³è¼¸å…¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <select id="voice-lang-select" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="cmn-Hant-TW">ä¸­æ–‡ (ç¹é«”)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="en-US">English</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="ja-JP">Japanese</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="hi-IN">Hindi (å°åœ°èª)</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" id="recent-records-card" style="margin-top: 15px;">
Â  Â  Â  Â  Â  Â  <span class="section-title">3. Recent Records (è¿‘æœŸç´€éŒ„ - Last 10)</span>
Â  Â  Â  Â  Â  Â  <ul id="recent-records-list" style="list-style: none; padding: 0; margin: 0; font-size: 0.9em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li style="color: #999;">Loading recent records...</li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="footer-btns">
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-copy" onclick="copyFormattedInfo()">ğŸ“‹ Copy Info</button>
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" id="saveBtn" onclick="saveToCloud()">ğŸ’¾ Save to Cloud</button>
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-view" onclick="viewExcel()">ğŸ“Š View Excel</button>
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-drive" onclick="viewDriveFolder()">ğŸ“‚ View Photos</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="settings-modal" style="display: none;">
Â  Â  Â  Â  <div class="modal-box">
Â  Â  Â  Â  Â  Â  <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Settings (è¨­å®š)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeSettings()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="settings-content-group">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group" style="background: #f9f9f9; padding: 10px; border-radius: 8px; border: 1px dashed #ccc;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="color:#d63384; font-weight: bold; margin-bottom: 5px; display: block;">ğŸ”‘ Login Password (ä¿®æ”¹ç™»å…¥å¯†ç¢¼) (Default: 12345)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="set-password" class="login-input" style="margin: 0;" placeholder="Current: 12345">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">1. Voice Timeout (éŒ„éŸ³éœé»˜ç§’æ•¸)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="set-timeout" class="login-input" style="margin: 0;" placeholder="Default: 1.5 (seconds)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">2. Photo Aspect Ratio (ç…§ç‰‡æ¯”ä¾‹)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="set-ratio" class="login-input" style="margin: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="4/3">4:3 (Standard)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="16/9">16:9 (Wide)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="9/16">9:16 (Vertical / ç›´å¼)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="1/1">1:1 (Square)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.8rem; color: #888; margin-top: 3px;">* Applies auto-crop.</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">3. Voice Language (èªéŸ³è¾¨è­˜èªè¨€)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="set-lang" class="login-input" style="margin: 0;" onchange="syncLanguage()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cmn-Hant-TW">Traditional Chinese (ç¹é«”ä¸­æ–‡)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="en-US">English</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ja-JP">Japanese</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="hi-IN">Hindi (å°åœ°èª)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group" style="border: 1px solid #ddd; padding: 10px; border-radius: 8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 10px; display: block; color: var(--copy-color);">4. Concern Section List Management<br>(ç›¸é—œéƒ¨é–€åˆ—è¡¨ç®¡ç†)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="new-concern-section" class="login-input" style="margin: 0 0 5px 0;" placeholder="Add new section (e.g., Electrical)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-add-item" onclick="addConcernSection()">+ Add Section (æ–°å¢)</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="concern-section-list-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="modal-group" style="border: 1px solid #ddd; padding: 10px; border-radius: 8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 10px; display: block; color: var(--copy-color);">5. Machine List Management<br>(æ©Ÿå™¨åˆ—è¡¨ç®¡ç†)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="new-machine-name" class="login-input" style="margin: 0 0 5px 0;" placeholder="Add new machine name (e.g., CM4)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-add-item" onclick="addMachine()">+ Add Machine (æ–°å¢)</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="machine-list-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div style="text-align: center; color: var(--primary-color); font-size: 0.9em; margin-top: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <p>âœ… Cloud Paths are Locked (System Mode)</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" onclick="saveSettings()">Save Settings (å„²å­˜è¨­å®š)</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

<script>
Â  Â  // ================= åƒæ•¸èˆ‡åˆå§‹åŒ– =================
Â  Â  const DEFAULT_PASS = "12345";Â 
Â  Â  const MAX_IMAGE_WIDTH = 1000;
Â  Â  const MACHINE_LIST_KEY = "cfg_machine_list";
Â  Â  const CONCERN_LIST_KEY = "cfg_concern_list";Â 
Â  Â  const EMPLOYEE_ID_KEY = "cfg_employee_id";Â 
Â  Â  const DEFAULT_MACHINE_LIST = ["BM5", "BM6", "BM7", "BM21", "BM22", "BM23", "CA3", "CA4", "CM1", "CM2", "CM3"];
Â  Â  // ä¿®æ­£ Concern List åˆå§‹å€¼
Â  Â  const DEFAULT_CONCERN_LIST = ["Mixing", "Extrusion", "Cutting", "Calendering"];Â 
Â  Â  const DEFAULT_VOICE_TIMEOUT = 1.5;

Â  Â  // ä½ çš„å›ºå®šè·¯å¾‘ (FIXED PATHS) - å·²å¯«æ­»
Â  Â  const FIXED_SCRIPT_ID = "AKfycbzfPzPODQjp_phrHPwjsoBYeA8-VgeaoYly6hr3Mx09Wj-o5tWHMPa-nTHfaHyloiH8zg/exec";
Â  Â  const FIXED_SHEET_ID = "1sDKZBJfasUbZSGNAfz9GIWfRdrdXxQMrXrxM3x9RlCY";Â 
Â  Â  const FIXED_FOLDER_ID = "1VPfLCMIuJPA66RjN8isrC4xq3luPMJe4";
    // å¾ç¶²é  URL å‹•æ…‹ç²å– SCRIPT URL (é˜²æ­¢ç¡¬ç·¨ç¢¼å¿«å–å•é¡Œ)
Â  Â  const SCRIPT_URL = 'https://script.google.com/macros/s/' + FIXED_SCRIPT_ID + '/exec';


Â  Â  // ç‹€æ…‹è®Šæ•¸
Â  Â  let processedImageBase64 = "";Â 
Â  Â  let recognition = null;
Â  Â  let isRecording = false;Â 
Â  Â  let activeTextAreaId = null;Â 
Â  Â  let snapshotText = "";Â  Â  Â  Â 
Â  Â  let punctuationTimer = null;Â 

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  if (typeof initApp === 'function') {
Â  Â  Â  Â  Â  Â  initApp();
Â  Â  Â  Â  }
Â  Â  });

Â  Â  function initApp() {
Â  Â  Â  Â  if(!localStorage.getItem("app_password")) {
Â  Â  Â  Â  Â  Â  localStorage.setItem("app_password", DEFAULT_PASS);
Â  Â  Â  Â  }
Â  Â  Â  Â  if(!localStorage.getItem(MACHINE_LIST_KEY)) {
Â  Â  Â  Â  Â  Â  localStorage.setItem(MACHINE_LIST_KEY, JSON.stringify(DEFAULT_MACHINE_LIST));
Â  Â  Â  Â  }
Â  Â  Â  Â  if(!localStorage.getItem(CONCERN_LIST_KEY)) { // åˆå§‹åŒ– Concern List
Â  Â  Â  Â  Â  Â  localStorage.setItem(CONCERN_LIST_KEY, JSON.stringify(DEFAULT_CONCERN_LIST));
Â  Â  Â  Â  }
Â  Â  Â  Â  if(!localStorage.getItem("cfg_timeout")) {
Â  Â  Â  Â  Â  Â  localStorage.setItem("cfg_timeout", DEFAULT_VOICE_TIMEOUT);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadSettingsToUI();
Â  Â  Â  Â  loadMachineListToUI();
Â  Â  Â  Â  loadConcernSectionToUI();Â 
Â  Â  Â  Â  loadEmployeeID();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('input-stop-time-full').value = "";
Â  Â  Â  Â  document.getElementById('input-start-time-full').value = "";
Â  Â  Â  Â  document.getElementById('input-total-time').value = "";
Â  Â  Â  Â  document.getElementById('input-total-time').style.backgroundColor = '#eee';
Â  Â  Â  Â  document.getElementById('total-time-unit').value = 'min'; // é è¨­ Total Time å–®ä½ç‚ºåˆ†é˜
Â  Â  Â  Â Â 
Â  Â  Â  Â  const isLoggedIn = localStorage.getItem("isLoggedIn");
Â  Â  Â  Â  if(isLoggedIn === "true") {
Â  Â  Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  Â  Â  Â  Â  applySettings();
Â  Â  Â  Â  Â  Â  loadRecentRecords(); // <<< [æ–°å¢] è¼‰å…¥æœ€è¿‘ç´€éŒ„
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'flex';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // ================= å“¡å·¥ ID æŒä¹…åŒ– (ä¿æŒä¸è®Š) =================
Â  Â  function loadEmployeeID() {
Â  Â  Â  Â  const savedId = localStorage.getItem(EMPLOYEE_ID_KEY);
Â  Â  Â  Â  if (savedId) {
Â  Â  Â  Â  Â  Â  document.getElementById('input-employee-id').value = savedId;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function saveEmployeeID() {
Â  Â  Â  Â  const employeeId = document.getElementById('input-employee-id').value.trim();
Â  Â  Â  Â  localStorage.setItem(EMPLOYEE_ID_KEY, employeeId);
Â  Â  }

Â  Â  // ================= Concern Section ç®¡ç† (ä¿æŒé‚è¼¯) =================
Â  Â  function getConcernList() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  return JSON.parse(localStorage.getItem(CONCERN_LIST_KEY)) || DEFAULT_CONCERN_LIST;
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Failed to parse concern list", e);
Â  Â  Â  Â  Â  Â  return DEFAULT_CONCERN_LIST;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function saveConcernList(list) {
Â  Â  Â  Â  const uniqueSortedList = [...new Set(list)].sort((a, b) => a.localeCompare(b));
Â  Â  Â  Â  localStorage.setItem(CONCERN_LIST_KEY, JSON.stringify(uniqueSortedList));
Â  Â  Â  Â  loadConcernSectionToUI();
Â  Â  Â  Â  return uniqueSortedList;
Â  Â  }

Â  Â  function loadConcernSectionToUI() {
Â  Â  Â  Â  const select = document.getElementById('input-concern-section');
Â  Â  Â  Â  const list = getConcernList();
Â  Â  Â  Â Â 
Â  Â  Â  Â  select.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  const defaultOption = document.createElement('option');
Â  Â  Â  Â  defaultOption.value = "";
Â  Â  Â  Â  defaultOption.textContent = "--- Select Section ---";
Â  Â  Â  Â  select.appendChild(defaultOption);

Â  Â  Â  Â  list.forEach(section => {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = section;
Â  Â  Â  Â  Â  Â  option.textContent = section;
Â  Â  Â  Â  Â  Â  select.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (document.getElementById('settings-modal').style.display === 'flex') {
Â  Â  Â  Â  Â  Â  renderConcernListSettings();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderConcernListSettings() {
Â  Â  Â  Â  const container = document.getElementById('concern-section-list-container');
Â  Â  Â  Â  const list = getConcernList();
Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  list.forEach((section, index) => {
Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className = 'machine-list-item';
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight: bold;">${section}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-remove-item" onclick="removeConcernSection('${section}')">X</button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(item);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function addConcernSection() {
Â  Â  Â  Â  const input = document.getElementById('new-concern-section');
Â  Â  Â  Â  const newSection = input.value.trim();

Â  Â  Â  Â  if (newSection === "" || newSection === "--- SELECT SECTION ---") {
Â  Â  Â  Â  Â  Â  alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„éƒ¨é–€åç¨±ã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  let list = getConcernList();
Â  Â  Â  Â  if (list.includes(newSection)) {
Â  Â  Â  Â  Â  Â  alert(`éƒ¨é–€ ${newSection} å·²ç¶“å­˜åœ¨æ–¼æ¸…å–®ä¸­ã€‚`);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  list.push(newSection);
Â  Â  Â  Â  saveConcernList(list);
Â  Â  Â  Â Â 
Â  Â  Â  Â  input.value = "";
Â  Â  }

Â  Â  function removeConcernSection(name) {
Â  Â  Â  Â  if (!confirm(`ç¢ºå®šè¦å¾æ¸…å–®ä¸­åˆªé™¤éƒ¨é–€ ${name} å—ï¼Ÿ`)) return;

Â  Â  Â  Â  let list = getConcernList();
Â  Â  Â  Â  const newList = list.filter(m => m !== name);
Â  Â  Â  Â  saveConcernList(newList);
Â  Â  }

Â  Â  // ================= ç™»å…¥èˆ‡è¨­å®šç®¡ç† (ä¿æŒä¸è®Š) =================
Â  Â Â 
Â  Â  function openSettings() {
Â  Â  Â  Â  loadSettingsToUI();
Â  Â  Â  Â  loadMachineListToUI();
Â  Â  Â  Â  loadConcernSectionToUI();Â 
Â  Â  Â  Â  document.getElementById('settings-modal').style.display = 'flex';
Â  Â  }
Â  Â Â 
Â  Â  function checkLogin() {
Â  Â  Â  Â  const input = document.getElementById('loginPass').value;
Â  Â  Â  Â  const storedPass = localStorage.getItem("app_password");Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(input === storedPass) {
Â  Â  Â  Â  Â  Â  localStorage.setItem("isLoggedIn", "true");
Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  Â  Â  Â  Â  applySettings();
Â  Â  Â  Â  Â  Â  loadRecentRecords(); // <<< [æ–°å¢] è¼‰å…¥æœ€è¿‘ç´€éŒ„
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("Wrong Password! (å¯†ç¢¼éŒ¯èª¤)");
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function saveSettings() {
Â  Â  Â  Â  const newPass = document.getElementById('set-password').value;
Â  Â  Â  Â  const ratio = document.getElementById('set-ratio').value;
Â  Â  Â  Â  const lang = document.getElementById('set-lang').value;
Â  Â  Â  Â  const timeout = document.getElementById('set-timeout').value;Â 

Â  Â  Â  Â  if(newPass.trim() === "") { alert("Password cannot be empty!"); return; }
Â  Â  Â  Â  if(isNaN(parseFloat(timeout)) || parseFloat(timeout) <= 0) {
Â  Â  Â  Â  Â  Â  alert("éŒ„éŸ³éœé»˜ç§’æ•¸å¿…é ˆæ˜¯æœ‰æ•ˆçš„æ•¸å­— (å¤§æ–¼ 0)ã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  localStorage.setItem("app_password", newPass);Â 
Â  Â  Â  Â  localStorage.setItem("cfg_ratio", ratio);
Â  Â  Â  Â  localStorage.setItem("cfg_lang", lang);
Â  Â  Â  Â  localStorage.setItem("cfg_timeout", timeout);Â 

Â  Â  Â  Â  alert("Settings Saved!");
Â  Â  Â  Â  closeSettings();
Â  Â  Â  Â  applySettings();
Â  Â  }

Â  Â  function loadSettingsToUI() {
Â  Â  Â  Â  document.getElementById('set-password').value = localStorage.getItem("app_password") || DEFAULT_PASS;
Â  Â  Â  Â  document.getElementById('set-ratio').value = localStorage.getItem("cfg_ratio") || "4/3";
Â  Â  Â  Â  document.getElementById('set-timeout').value = localStorage.getItem("cfg_timeout") || DEFAULT_VOICE_TIMEOUT;Â 
Â  Â  Â  Â  const savedLang = localStorage.getItem("cfg_lang") || "cmn-Hant-TW";
Â  Â  Â  Â  document.getElementById('set-lang').value = savedLang;
Â  Â  Â  Â  document.getElementById('voice-lang-select').value = savedLang;
Â  Â  }
Â  Â Â 
Â  Â  function applySettings() {
Â  Â  Â  Â  const ratio = localStorage.getItem("cfg_ratio") || "4/3";
Â  Â  Â  Â  const container = document.getElementById('preview-container');
Â  Â  Â  Â  const tag = document.getElementById('ratio-display-tag');
Â  Â  Â  Â Â 
Â  Â  Â  Â  container.className = "";Â 
Â  Â  Â  Â  container.style.aspectRatio = "";

Â  Â  Â  Â  if(ratio !== "FULL") {
Â  Â  Â  Â  Â  Â  const ratioClass = `ratio-${ratio.replace("/", "-")}`;
Â  Â  Â  Â  Â  Â  container.classList.add(ratioClass);
Â  Â  Â  Â  Â  Â  tag.innerText = `Ratio: ${ratio.replace("/", ":")}`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â tag.innerText = "Ratio: Full (Original)";
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  calculateTotalStopTime();
Â  Â  }
Â  Â Â 
Â  Â  function logout() {
Â  Â  Â  Â  if(confirm("Lock and logout?\n(ç¢ºå®šè¦é–å®šä¸¦ç™»å‡ºå—ï¼Ÿ)")) {
Â  Â  Â  Â  Â  Â  localStorage.removeItem("isLoggedIn");Â 
Â  Â  Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'flex';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('loginPass').value = "";Â 
Â  Â  Â  Â  Â  Â  closeSettings();
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function closeSettings() {
Â  Â  Â  Â  document.getElementById('settings-modal').style.display = 'none';
Â  Â  }
Â  Â  function syncLanguage() {
Â  Â  Â  Â  const val = document.getElementById('set-lang').value;
Â  Â  Â  Â  document.getElementById('voice-lang-select').value = val;
Â  Â  Â  Â  localStorage.setItem("cfg_lang", val);
Â  Â  }
Â  Â Â 
Â  Â  // ... æ©Ÿå™¨åˆ—è¡¨ç®¡ç†å‡½æ•¸ (ä¿æŒä¸è®Š) ...
Â  Â  function getMachineList() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  return JSON.parse(localStorage.getItem(MACHINE_LIST_KEY)) || DEFAULT_MACHINE_LIST;
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Failed to parse machine list", e);
Â  Â  Â  Â  Â  Â  return DEFAULT_MACHINE_LIST;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  function saveMachineList(list) {
Â  Â  Â  Â  const uniqueSortedList = [...new Set(list)].sort((a, b) => a.localeCompare(b));
Â  Â  Â  Â  localStorage.setItem(MACHINE_LIST_KEY, JSON.stringify(uniqueSortedList));
Â  Â  Â  Â  loadMachineListToUI();
Â  Â  Â  Â  return uniqueSortedList;
Â  Â  }
Â  Â  function loadMachineListToUI() {
Â  Â  Â  Â  const select = document.getElementById('input-machine');
Â  Â  Â  Â  const list = getMachineList();
Â  Â  Â  Â Â 
Â  Â  Â  Â  select.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  const defaultOption = document.createElement('option');
Â  Â  Â  Â  defaultOption.value = "";
Â  Â  Â  Â  defaultOption.textContent = "--- Select Machine ---";
Â  Â  Â  Â  select.appendChild(defaultOption);

Â  Â  Â  Â  list.forEach(machine => {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = machine;
Â  Â  Â  Â  Â  Â  option.textContent = machine;
Â  Â  Â  Â  Â  Â  select.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (document.getElementById('settings-modal').style.display === 'flex') {
Â  Â  Â  Â  Â  Â  renderMachineListSettings();
Â  Â  Â  Â  }
Â  Â  }
Â  Â  function renderMachineListSettings() {
Â  Â  Â  Â  const container = document.getElementById('machine-list-container');
Â  Â  Â  Â  const list = getMachineList();
Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  list.forEach((machine, index) => {
Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className = 'machine-list-item';
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight: bold;">${machine}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-remove-item" onclick="removeMachine('${machine}')">X</button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(item);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  function addMachine() {
Â  Â  Â  Â  const input = document.getElementById('new-machine-name');
Â  Â  Â  Â  const newMachine = input.value.trim().toUpperCase();

Â  Â  Â  Â  if (newMachine === "" || newMachine === "--- SELECT MACHINE ---") {
Â  Â  Â  Â  Â  Â  alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„æ©Ÿå™¨åç¨±ã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  let list = getMachineList();
Â  Â  Â  Â  if (list.includes(newMachine)) {
Â  Â  Â  Â  Â  Â  alert(`æ©Ÿå™¨ ${newMachine} å·²ç¶“å­˜åœ¨æ–¼æ¸…å–®ä¸­ã€‚`);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  list.push(newMachine);
Â  Â  Â  Â  saveMachineList(list);
Â  Â  Â  Â Â 
Â  Â  Â  Â  input.value = "";
Â  Â  }

Â  Â  function removeMachine(name) {
Â  Â  Â  Â  if (!confirm(`ç¢ºå®šè¦å¾æ¸…å–®ä¸­åˆªé™¤æ©Ÿå™¨ ${name} å—ï¼Ÿ`)) return;

Â  Â  Â  Â  let list = getMachineList();
Â  Â  Â  Â  const newList = list.filter(m => m !== name);
Â  Â  Â  Â  saveMachineList(newList);
Â  Â  }


Â  Â  // ================= æ™‚é–“è™•ç†å‡½æ•¸ (ä¿æŒä¸è®Š) =================
Â  Â  const DATETIME_REGEX = /^(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2})$/;

Â  Â  function parseCustomDateTime(dtStr) {
Â  Â  Â  Â  const match = dtStr.match(DATETIME_REGEX);
Â  Â  Â  Â  if (!match) return null;

Â  Â  Â  Â  const day = parseInt(match[1], 10);
Â  Â  Â  Â  const month = parseInt(match[2], 10) - 1;Â 
Â  Â  Â  Â  const year = parseInt(match[3], 10);
Â  Â  Â  Â  const hour = parseInt(match[4], 10);
Â  Â  Â  Â  const minute = parseInt(match[5], 10);

Â  Â  Â  Â  const date = new Date(year, month, day, hour, minute);

Â  Â  Â  Â  if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) {
Â  Â  Â  Â  Â  Â  Â return null;
Â  Â  Â  Â  }

Â  Â  Â  Â  return date;
Â  Â  }
Â  Â Â 
Â  Â  function calculateTotalStopTime() {
Â  Â  Â  Â  const stopTimeStr = document.getElementById('input-stop-time-full').value.trim();
Â  Â  Â  Â  const startTimeStr = document.getElementById('input-start-time-full').value.trim();
Â  Â  Â  Â  const totalTimeInput = document.getElementById('input-total-time');
Â  Â  Â  Â  const unitSelect = document.getElementById('total-time-unit');
Â  Â  Â  Â  const unit = unitSelect ? unitSelect.value : 'h';

Â  Â  Â  Â  if (stopTimeStr === "" || startTimeStr === "") {
Â  Â  Â  Â  Â  Â  Â totalTimeInput.value = "";
Â  Â  Â  Â  Â  Â  Â totalTimeInput.style.backgroundColor = '#eee';
Â  Â  Â  Â  Â  Â  Â totalTimeInput.dataset.diffMinutes = '';Â 
Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const stopDate = parseCustomDateTime(stopTimeStr);
Â  Â  Â  Â  const startDate = parseCustomDateTime(startTimeStr);

Â  Â  Â  Â  if (!stopDate || !startDate) {
Â  Â  Â  Â  Â  Â  totalTimeInput.value = "Invalid Time";
Â  Â  Â  Â  Â  Â  totalTimeInput.style.backgroundColor = '#fff0f0';
Â  Â  Â  Â  Â  Â  totalTimeInput.dataset.diffMinutes = '';Â 
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const diffMs = startDate.getTime() - stopDate.getTime();
Â  Â  Â  Â  const diffMinutes = Math.round(diffMs / (1000 * 60));Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (diffMinutes <= 0) {
Â  Â  Â  Â  Â  Â  totalTimeInput.value = "0 min / 0.00 hr";
Â  Â  Â  Â  Â  Â  totalTimeInput.style.backgroundColor = '#fff0f0';
Â  Â  Â  Â  Â  Â  totalTimeInput.dataset.diffMinutes = 0;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  totalTimeInput.dataset.diffMinutes = diffMinutes;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  let totalTimeFormatted;
Â  Â  Â  Â  if (unit === 'h') {
Â  Â  Â  Â  Â  Â  Â const diffHours = diffMs / (1000 * 60 * 60);
Â  Â  Â  Â  Â  Â  Â totalTimeFormatted = diffHours.toFixed(2) + " hr";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â totalTimeFormatted = diffMinutes + " min";
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  totalTimeInput.value = totalTimeFormatted;
Â  Â  Â  Â  totalTimeInput.style.backgroundColor = '#e6ffed';
Â  Â  }


Â  Â  function getFullDateTimeString(dateObj) {
Â  Â  Â  Â  const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
Â  Â  Â  Â  const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: false };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const datePart = dateObj.toLocaleDateString('en-US', dateOptions).replace(/\//g, '/');
Â  Â  Â  Â  const timePart = dateObj.toLocaleTimeString('en-US', timeOptions).replace(/^(\d):/,'0$1:');Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  return `${datePart} ${timePart}`;
Â  Â  }
Â  Â Â 
Â  Â  function updateSingleTime(targetId) {
Â  Â  Â  Â  const targetElement = document.getElementById(targetId);
Â  Â  Â  Â  const fullDateTime = getFullDateTimeString(new Date());
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (targetElement) {
Â  Â  Â  Â  Â  Â  Â targetElement.value = fullDateTime;
Â  Â  Â  Â  Â  Â  Â calculateTotalStopTime();
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // ================= è¤‡è£½æ ¼å¼åŒ–è¨Šæ¯ (ä¿®æ­£æ ¼å¼èˆ‡å…§å®¹) =================
Â  Â Â 
Â  Â  function extractDateAndTime(fullTimeStr) {
Â  Â  Â  Â  const match = fullTimeStr.match(DATETIME_REGEX);
Â  Â  Â  Â  if (match) {
Â  Â  Â  Â  Â  Â  Â const datePart = `${match[1]}/${match[2]}/${match[3]}`;Â 
Â  Â  Â  Â  Â  Â  Â const timePart = `${match[4]}:${match[5]}`;Â 
Â  Â  Â  Â  Â  Â  Â return { date: datePart, time: timePart };
Â  Â  Â  Â  }
Â  Â  Â  Â  return { date: '', time: '' };Â 
Â  Â  }
Â  Â Â 
Â  Â  function copyFormattedInfo() {
Â  Â  Â  Â  const totalTimeInput = document.getElementById('input-total-time');
Â  Â  Â  Â  const totalTimeMinutes = totalTimeInput.dataset.diffMinutes;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ä¿®æ­£ Total Time æ ¼å¼: åªæœ‰åœ¨æœ‰æœ‰æ•ˆåˆ†é˜æ•¸æ™‚æ‰é¡¯ç¤ºæ ¼å¼
Â  Â  Â  Â  let totalTimeFormat;
Â  Â  Â  Â  if (totalTimeMinutes && totalTimeMinutes > 0) {
Â  Â  Â  Â  Â  Â  const totalTimeHours = (totalTimeMinutes / 60).toFixed(2);
Â  Â  Â  Â  Â  Â  totalTimeFormat = `${totalTimeMinutes} Min / ${totalTimeHours} hr`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  totalTimeFormat = '';Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. è’é›†è³‡æ–™
Â  Â  Â  Â  const employeeId = document.getElementById('input-employee-id').value || "N/A";
Â  Â  Â  Â  const machine = document.getElementById('input-machine').value || "N/A";
Â  Â  Â  Â  const stopTimeFull = document.getElementById('input-stop-time-full').value.trim();
Â  Â  Â  Â  const startTimeFull = document.getElementById('input-start-time-full').value.trim();
Â  Â  Â  Â  const repairFormNo = document.getElementById('input-form-no').value || "N/A";
Â  Â  Â  Â  const reason = document.getElementById('input-reason').value || "N/A";
Â  Â  Â  Â  const concernSection = document.getElementById('input-concern-section').value || "N/A";Â 
Â  Â  Â  Â  const solution = document.getElementById('input-solution').value || "N/A";
Â  Â  Â  Â  const selfActions = document.getElementById('input-self-actions').value || "N/A";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. è™•ç†æ™‚é–“
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ä¿®æ­£ Start Time é¡¯ç¤ºï¼šå¦‚æœ Start Time ç‚ºç©ºï¼Œé¡¯ç¤ºç©ºå­—ä¸²
Â  Â  Â  Â  const startDisplay = startTimeFull === "" ? '' : startTimeFull;

Â  Â  Â  Â  // 3. æ§‹å»ºè¼¸å‡ºå­—ä¸² (æœ€çµ‚æ ¼å¼: å»é™¤æ‰€æœ‰ "-" ç¬¦è™Ÿ)
Â  Â  Â  Â  const output = `
ID : ${employeeId}

Machine : ${machine}

Concern Section : ${concernSection}

Stop time : ${stopTimeFull}

Start time : ${startDisplay}

Total stop time : ${totalTimeFormat}

Repair Form No: ${repairFormNo}

Reason :
${reason.replace(/\n/g, '\n')}

How to Solve Problem:
${solution.replace(/\n/g, '\n')}

Self Actions:
${selfActions.replace(/\n/g, '\n')}
Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  // 4. è¤‡è£½åˆ°å‰ªè²¼ç°¿
Â  Â  Â  Â  navigator.clipboard.writeText(output).then(() => {
Â  Â  Â  Â  Â  Â  alert("âœ… æ•´åˆè¨Šæ¯å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
Â  Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  Â  Â  console.error('ç„¡æ³•è¤‡è£½æ–‡å­—:', err);
Â  Â  Â  Â  Â  Â  alert("âŒ ç„¡æ³•è¤‡è£½æ–‡å­—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™ã€‚");
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // ================= ä¸Šå‚³èˆ‡æ¸…é™¤é‚è¼¯ (ä¿æŒä¸è®Š) =================
Â  Â  function clearInputs() {
Â  Â  Â  Â  document.getElementById('input-machine').value = "";Â 
Â  Â  Â  Â  document.getElementById('input-total-time').value = "";
Â  Â  Â  Â  document.getElementById('input-form-no').value = "";
Â  Â  Â  Â  document.getElementById('input-reason').value = "";
Â  Â  Â  Â  document.getElementById('input-concern-section').value = "";
Â  Â  Â  Â  document.getElementById('input-solution').value = "";
Â  Â  Â  Â  document.getElementById('input-self-actions').value = "";

Â  Â  Â  Â  document.getElementById('input-stop-time-full').value = "";
Â  Â  Â  Â  document.getElementById('input-start-time-full').value = "";
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('input-total-time').style.backgroundColor = '#eee';
Â  Â  Â  Â  calculateTotalStopTime();Â 

Â  Â  Â  Â  processedImageBase64 = "";
Â  Â  Â  Â  document.getElementById('preview-img').style.display = 'none';
Â  Â  Â  Â  document.querySelector('.placeholder').style.display = 'block';
Â  Â  Â  Â  applySettings();
Â  Â  }

Â  Â  function saveToCloud() {
Â  Â  Â  Â  if(isRecording) manualStopVoice();

Â  Â  Â  Â  const employeeId = document.getElementById('input-employee-id').value;Â 
Â  Â  Â  Â  const machine = document.getElementById('input-machine').value;Â 
Â  Â  Â  Â  const stopTimeFull = document.getElementById('input-stop-time-full').value;Â 
Â  Â  Â  Â  const startTimeFull = document.getElementById('input-start-time-full').value;Â 
Â  Â  Â  Â  const totalTime = document.getElementById('input-total-time').value;Â 
Â  Â  Â  Â  const formNo = document.getElementById('input-form-no').value;
Â  Â  Â  Â  const reason = document.getElementById('input-reason').value;
Â  Â  Â  Â  const concernSection = document.getElementById('input-concern-section').value;
Â  Â  Â  Â  const solution = document.getElementById('input-solution').value;Â 
Â  Â  Â  Â  const selfActions = document.getElementById('input-self-actions').value;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (formNo.trim() === "") {
Â  Â  Â  Â  Â  Â  alert("è«‹å¡«å¯« Repair Form No ä»¥ä¾¿è¿½è¹¤ã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if(!processedImageBase64 && !machine && !reason && !solution && !concernSection && !selfActions) {Â 
Â  Â  Â  Â  Â  Â  alert("Empty! Please fill in machine info/notes or take a photo."); return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (machine.trim() === "") {
Â  Â  Â  Â  Â  Â  alert("è«‹é¸æ“‡ Machine (æ©Ÿå°)ã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  saveEmployeeID();

Â  Â  Â  Â  const scriptUrl = SCRIPT_URL;
Â  Â  Â  Â  const btn = document.getElementById('saveBtn');
Â  Â  Â  Â Â 
Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  showStatus('loading', 'Uploading...', 'è³‡æ–™ä¸Šå‚³ä¸­...');

Â  Â  Â  Â  const data = {Â 
Â  Â  Â  Â  Â  Â  image: processedImageBase64,Â 
Â  Â  Â  Â  Â  Â  employeeId: employeeId,Â 
Â  Â  Â  Â  Â  Â  machine: machine,
Â  Â  Â  Â  Â  Â  stopTimeFull: stopTimeFull,
Â  Â  Â  Â  Â  Â  startTimeFull: startTimeFull,
Â  Â  Â  Â  Â  Â  totalTime: totalTime,Â 
Â  Â  Â  Â  Â  Â  formNo: formNo,
Â  Â  Â  Â  Â  Â  reason: reason,Â 
Â  Â  Â  Â  Â  Â  concernSection: concernSection,
Â  Â  Â  Â  Â  Â  solution: solution,Â 
Â  Â  Â  Â  Â  Â  selfActions: selfActions,
Â  Â  Â  Â  Â  Â  folderId: FIXED_FOLDER_ID
Â  Â  Â  Â  };

Â  Â  Â  Â  fetch(scriptUrl, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: JSON.stringify(data)
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  const action = res.action || 'æ–°å¢';Â 
Â  Â  Â  Â  Â  Â  if (res.result === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('success', 'Upload Success!', `è³‡æ–™å·²æˆåŠŸ ${action}ï¼`);
Â  Â  Â  Â  Â  Â  Â  Â  clearInputs();
Â  Â  Â  Â  Â  Â  Â  Â  loadRecentRecords(); // æˆåŠŸå¾Œæ›´æ–°åˆ—è¡¨
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { closeStatusModal(); }, 2000);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('error', 'Upload Failed', `ä¸Šå‚³å¤±æ•—ï¼š${res.error || 'æœªçŸ¥çš„éŒ¯èª¤ã€‚'}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  showStatus('error', 'Upload Failed', 'ç¶²è·¯æˆ–ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ã€‚');
Â  Â  Â  Â  })
Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function viewExcel() {
Â  Â  Â  Â  const url = `https://docs.google.com/spreadsheets/d/${FIXED_SHEET_ID}/edit#gid=0`;
Â  Â  Â  Â  window.open(url, '_blank');
Â  Â  }

Â  Â  function viewDriveFolder() {
Â  Â  Â  Â  if(FIXED_FOLDER_ID && FIXED_FOLDER_ID.trim() !== "") {
Â  Â  Â  Â  Â  Â  window.open(`https://drive.google.com/drive/folders/${FIXED_FOLDER_ID}`, '_blank');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("Folder ID not set.");
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // ... åœ–ç‰‡/èªéŸ³å‡½æ•¸ä¿æŒä¸è®Š ...
Â  Â  function triggerFile(id) {Â 
Â  Â  Â  Â  if (window.location.protocol === 'http:' && !window.location.hostname.includes('localhost')) {
Â  Â  Â  Â  Â  Â  alert("âŒ ç›¸æ©ŸåŠŸèƒ½éœ€è¦ HTTPS å”å®šã€‚è«‹ä½¿ç”¨ Apps Script ç¶²å€é–‹å•Ÿã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById(id).click();
Â  Â  }
Â  Â Â 
Â  Â  function handleFile(input) {
Â  Â  Â  Â  if (!input.files || !input.files[0]) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const file = input.files[0];
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â Â 
Â  Â  Â  Â  reader.onload = function(e) {
Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  img.onload = function() { processImageWithCanvas(img); };
Â  Â  Â  Â  Â  Â  img.src = e.target.result;
Â  Â  Â  Â  }
Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  }
Â  Â Â 
Â  Â  function processImageWithCanvas(img) {
Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  const ratioStr = localStorage.getItem("cfg_ratio") || "4/3";
Â  Â  Â  Â Â 
Â  Â  Â  Â  let targetRatio = 4/3;
Â  Â  Â  Â  let isFull = ratioStr === "FULL";

Â  Â  Â  Â  if(ratioStr === "16/9") targetRatio = 16/9;
Â  Â  Â  Â  else if(ratioStr === "9/16") targetRatio = 9/16;
Â  Â  Â  Â  else if(ratioStr === "1/1") targetRatio = 1;

Â  Â  Â  Â  let srcW = img.width; let srcH = img.height;
Â  Â  Â  Â  let drawW, drawH, startX, startY;

Â  Â  Â  Â  if (isFull) {
Â  Â  Â  Â  Â  Â  drawW = srcW; drawH = srcH; startX = 0; startY = 0;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  let srcRatio = srcW / srcH;
Â  Â  Â  Â  Â  Â  if (srcRatio > targetRatio) {
Â  Â  Â  Â  Â  Â  Â  Â  drawH = srcH; drawW = srcH * targetRatio;
Â  Â  Â  Â  Â  Â  Â  Â  startX = (srcW - drawW) / 2; startY = 0;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  drawW = srcW; drawH = srcW / targetRatio;
Â  Â  Â  Â  Â  Â  Â  Â  startX = 0; startY = (srcH - drawH) / 2;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const scale = MAX_IMAGE_WIDTH / drawW;
Â  Â  Â  Â  canvas.width = MAX_IMAGE_WIDTH;Â 
Â  Â  Â  Â  canvas.height = drawH * scale;

Â  Â  Â  Â  ctx.drawImage(img, startX, startY, drawW, drawH, 0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  processedImageBase64 = canvas.toDataURL('image/jpeg', 0.8);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const preview = document.getElementById('preview-img');
Â  Â  Â  Â  preview.src = processedImageBase64;
Â  Â  Â  Â  preview.style.display = 'block';
Â  Â  Â  Â  document.querySelector('.placeholder').style.display = 'none';

Â  Â  Â  Â  if(isFull) {
Â  Â  Â  Â  Â  Â  Â const container = document.getElementById('preview-container');
Â  Â  Â  Â  Â  Â  Â container.classList.remove("ratio-4-3", "ratio-16-9", "ratio-9-16", "ratio-1-1");Â 
Â  Â  Â  Â  Â  Â  Â container.style.aspectRatio = `${canvas.width} / ${canvas.height}`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function toggleVoice(btn) {
Â  Â  Â  Â  if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
Â  Â  Â  Â  Â  Â  alert("âŒ èªéŸ³è¼¸å…¥è¢«é˜»æ“‹ï¼ç€è¦½å™¨ä¸æ”¯æ´ï¼Œæˆ–è«‹ç¢ºä¿ App é€é HTTPS ç¶²å€é–‹å•Ÿã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const targetId = btn.getAttribute('data-target');
Â  Â  Â  Â  const targetArea = document.getElementById(targetId);

Â  Â  Â  Â  if (isRecording && activeTextAreaId === targetId) {
Â  Â  Â  Â  Â  Â  manualStopVoice();Â 
Â  Â  Â  Â  } else if (isRecording && activeTextAreaId !== targetId) {
Â  Â  Â  Â  Â  Â  Â if(confirm(`ç›®å‰æ­£åœ¨éŒ„è£½å…¶ä»–æ¬„ä½ï¼Œç¢ºå®šè¦åˆ‡æ›åˆ° [${targetArea.previousElementSibling.innerText.trim()}] å—ï¼Ÿ`)) {
Â  Â  Â  Â  Â  Â  Â  Â  manualStopVoice();
Â  Â  Â  Â  Â  Â  Â  Â  startVoice(btn, targetArea, targetId);
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  startVoice(btn, targetArea, targetId);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function startVoice(btn, targetArea, targetId) {
Â  Â  Â  Â  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
Â  Â  Â  Â  recognition = new SpeechRecognition();
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.lang = document.getElementById('voice-lang-select').value || 'cmn-Hant-TW';
Â  Â  Â  Â  recognition.continuous = true;Â 
Â  Â  Â  Â  recognition.interimResults = true;Â 

Â  Â  Â  Â  isRecording = true;
Â  Â  Â  Â  activeTextAreaId = targetId;
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.querySelectorAll('.btn-voice').forEach(b => b.classList.remove('recording'));
Â  Â  Â  Â  btn.classList.add('recording');
Â  Â  Â  Â  btn.innerText = "ğŸ›‘ åœæ­¢éŒ„éŸ³";
Â  Â  Â  Â Â 
Â  Â  Â  Â  snapshotText = targetArea.value;
Â  Â  Â  Â  if(snapshotText.length > 0 && !snapshotText.endsWith(" ")) {
Â  Â  Â  Â  Â  Â  snapshotText += " ";
Â  Â  Â  Â  }

Â  Â  Â  Â  recognition.onresult = function(event) {
Â  Â  Â  Â  Â  Â  let currentSessionText = '';Â 
Â  Â  Â  Â  Â  Â  for (let i = event.resultIndex; i < event.results.length; ++i) {
Â  Â  Â  Â  Â  Â  Â  Â  currentSessionText += event.results[i][0].transcript;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  targetArea.value = snapshotText + currentSessionText;
Â  Â  Â  Â  Â  Â  targetArea.scrollTop = targetArea.scrollHeight;

Â  Â  Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(currentSessionText.trim().length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const timeoutMs = parseFloat(localStorage.getItem("cfg_timeout") || DEFAULT_VOICE_TIMEOUT) * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  punctuationTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualStopVoice();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, timeoutMs);Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  recognition.onend = function() {
Â  Â  Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);
Â  Â  Â  Â  Â  Â  resetVoiceUI();
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.onerror = function(event) {
Â  Â  Â  Â  Â  Â  console.error("Speech Recognition Error:", event.error);
Â  Â  Â  Â  Â  Â  resetVoiceUI();
Â  Â  Â  Â  Â  Â  alert(`âŒ èªéŸ³è¾¨è­˜ç™¼ç”ŸéŒ¯èª¤ï¼è«‹æª¢æŸ¥éº¥å…‹é¢¨æ¬Šé™æˆ– App æ˜¯å¦åœ¨ HTTPS ç’°å¢ƒä¸­ã€‚éŒ¯èª¤ç¢¼: ${event.error}`);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  recognition.start();
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  console.error("Start error", e);
Â  Â  Â  Â  Â  Â  resetVoiceUI();
Â  Â  Â  Â  Â  Â  alert("âŒ èªéŸ³ API å•Ÿå‹•å¤±æ•—ã€‚è«‹ç¢ºèªç€è¦½å™¨æ”¯æ´å’Œæ¬Šé™ã€‚");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function manualStopVoice() {
Â  Â  Â  Â  if(isRecording && recognition) {
Â  Â  Â  Â  Â  Â  isRecording = false;Â 
Â  Â  Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);

Â  Â  Â  Â  Â  Â  const targetArea = document.getElementById(activeTextAreaId);
Â  Â  Â  Â  Â  Â  let currentVal = targetArea.value.trim();
Â  Â  Â  Â  Â  Â  if(currentVal.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const lastChar = currentVal.slice(-1);
Â  Â  Â  Â  Â  Â  Â  Â  const lang = document.getElementById('voice-lang-select').value;
Â  Â  Â  Â  Â  Â  Â  Â  const marks = lang.includes('en') ? [",", "."] : ["ï¼Œ", "ã€‚", "ã€", "ï¼Ÿ", "ï¼"];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!marks.includes(lastChar)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mark = lang.includes('en') ? ". " : "ã€‚";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentVal += mark;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetArea.value = currentVal;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  recognition.stop();
Â  Â  Â  Â  Â  Â  resetVoiceUI();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function resetVoiceUI() {
Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.querySelectorAll('.btn-voice').forEach(b => {
Â  Â  Â  Â  Â  Â  Â b.classList.remove('recording');
Â  Â  Â  Â  Â  Â  Â b.innerText = "ğŸ¤ èªéŸ³è¼¸å…¥";
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  isRecording = false;
Â  Â  Â  Â  activeTextAreaId = null;
Â  Â  }

Â  Â  function showStatus(type, title, subtitle) {
Â  Â  Â  Â  const modal = document.getElementById('status-modal');
Â  Â  Â  Â  const spinner = document.getElementById('status-spinner');
Â  Â  Â  Â  const icon = document.getElementById('status-icon');
Â  Â  Â  Â  const text = document.getElementById('status-text');
Â  Â  Â  Â  const sub = document.getElementById('status-subtext');
Â  Â  Â  Â  const closeBtn = document.getElementById('status-close-btn');

Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  text.innerText = title; sub.innerText = subtitle;

Â  Â  Â  Â  spinner.style.display = (type === 'loading') ? 'block' : 'none';
Â  Â  Â  Â  icon.style.display = (type !== 'loading') ? 'block' : 'none';
Â  Â  Â  Â  closeBtn.style.display = (type === 'error' || type === 'success') ? 'block' : 'none';

Â  Â  Â  Â  if(type === 'success') icon.innerText = 'âœ…';
Â  Â  Â  Â  else if(type === 'error') icon.innerText = 'âŒ';
Â  Â  }

Â  Â  function closeStatusModal() { document.getElementById('status-modal').style.display = 'none'; }

Â  Â  function viewExcel() {
Â  Â  Â  Â  const url = `https://docs.google.com/spreadsheets/d/${FIXED_SHEET_ID}/edit#gid=0`;
Â  Â  Â  Â  window.open(url, '_blank');
Â  Â  }

Â  Â  function viewDriveFolder() {
Â  Â  Â  Â  if(FIXED_FOLDER_ID && FIXED_FOLDER_ID.trim() !== "") {
Â  Â  Â  Â  Â  Â  window.open(`https://drive.google.com/drive/folders/${FIXED_FOLDER_ID}`, '_blank');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("Folder ID not set.");
Â  Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  
// ================= ç´€éŒ„è®€å–èˆ‡è¡¨å–®å¡«å…¥åŠŸèƒ½ (æ–°å¢çš„é‚è¼¯) =================

/**
 * è¼‰å…¥æœ€è¿‘çš„ç´€éŒ„ä¸¦æ¸²æŸ“åˆ°åˆ—è¡¨ä¸­
 */
function loadRecentRecords() {
Â  Â  const listContainer = document.getElementById('recent-records-list');
Â  Â  // ä½¿ç”¨ SCRIPT_URL èª¿ç”¨å¾Œç«¯ doGetRecords (Action=loadRecords)
Â  Â  const scriptUrl = SCRIPT_URL + '?action=loadRecords';
Â  Â  
Â  Â  listContainer.innerHTML = '<li style="color: #999; text-align: center; margin-top: 10px;">Loading...</li>';

Â  Â  fetch(scriptUrl)
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (res.result === 'success' && res.data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  res.data.forEach(record => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = 'record-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.setAttribute('data-form-no', record.formNo);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // é»æ“Šäº‹ä»¶ï¼šå‘¼å« fillForm å‡½æ•¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.onclick = () => fillForm(record.formNo);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const totalTimeDisplay = record.totalTime && record.totalTime > 0 ? 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` (${record.totalTime} min / ${(record.totalTime / 60).toFixed(2)} hr)` : 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="record-title">#${record.formNo} - ${record.machine}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="record-subtitle">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Concern: ${record.concernSection}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="record-time">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Stop: ${record.stopTime || 'N/A'} | Start: ${record.startTime || 'N/A'} ${totalTimeDisplay}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listContainer.appendChild(listItem);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '<li style="color: #999; text-align: center; margin-top: 10px;">No recent records found.</li>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {
Â  Â  Â  Â  Â  Â  console.error("Failed to load recent records:", e);
Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '<li style="color: red; text-align: center; margin-top: 10px;">âŒ Failed to load data.</li>';
Â  Â  Â  Â  });
}


/**
 * æ ¹æ“š Form No ç²å–å–®ä¸€è³‡æ–™ä¸¦å¡«å…¥è¡¨å–®
 * @param {string} formNo - è¦è¼‰å…¥çš„ Repair Form No
 */
function fillForm(formNo) {
Â  Â  if (!formNo) return;
Â  Â  
Â  Â  if(!confirm(`ç¢ºå®šè¦è¼‰å…¥ Form No: ${formNo} çš„ç´€éŒ„ä¾†è£œå……æˆ–ä¿®æ”¹å—ï¼Ÿ\n(é€™æœƒè¦†è“‹ç•¶å‰è¡¨å–®å…§å®¹)`)) {
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // Action=getRow
Â  Â  const scriptUrl = SCRIPT_URL + `?action=getRow&formNo=${encodeURIComponent(formNo)}`;
Â  Â  showStatus('loading', 'Loading Record...', `è¼‰å…¥ ${formNo} ç´€éŒ„ä¸­...`);

Â  Â  fetch(scriptUrl)
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  if (res.result === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  handleRecordLoad(res.data);
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('success', 'Load Complete', `ç´€éŒ„ ${formNo} å·²è¼‰å…¥è¡¨å–®ï¼`);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('error', 'Load Failed', `è¼‰å…¥å¤±æ•—ï¼š${res.error}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {
Â  Â  Â  Â  Â  Â  console.error("Load failed:", e);
Â  Â  Â  Â  Â  Â  showStatus('error', 'Load Failed', 'ç¶²è·¯æˆ–ä¼ºæœå™¨éŒ¯èª¤ï¼Œç„¡æ³•è¼‰å…¥è³‡æ–™ã€‚');
Â  Â  Â  Â  })
Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  // å»¶é²é—œé–‰ Modal
Â  Â  Â  Â  Â  Â  setTimeout(() => { closeStatusModal(); }, 1500); 
Â  Â  Â  Â  });
}


/**
 * å°‡å¾ GAS ç²å–çš„å–®ä¸€ç´€éŒ„æ•¸æ“šå¡«å…¥ä¸»è¡¨å–®
 * @param {object} data - å¾ doGetRow ç²å–çš„ç´€éŒ„ç‰©ä»¶
 */
function handleRecordLoad(data) {
Â  Â  // 1. å¡«å…¥æ‰€æœ‰æ–‡å­—æ¬„ä½
Â  Â  document.getElementById('input-employee-id').value = data.employeeId || "";
Â  Â  document.getElementById('input-form-no').value = data.formNo || "";
Â  Â  document.getElementById('input-reason').value = data.reason || "";
Â  Â  document.getElementById('input-solution').value = data.solution || "";
Â  Â  document.getElementById('input-self-actions').value = data.selfActions || "";

Â  Â  // 2. å¡«å…¥ Select é¸å–® (æ©Ÿå° & éƒ¨é–€)
Â  Â  document.getElementById('input-machine').value = data.machine || "";
Â  Â  document.getElementById('input-concern-section').value = data.concernSection || "";

Â  Â  // 3. å¡«å…¥æ™‚é–“æ¬„ä½ (ç›´æ¥ä½¿ç”¨å¾Œç«¯å‚³å›çš„ DD/MM/YYYY hh:mm æ ¼å¼å­—ä¸²)
Â  Â  document.getElementById('input-stop-time-full').value = data.stopTimeFull || "";
Â  Â  document.getElementById('input-start-time-full').value = data.startTimeFull || "";
Â  Â  
Â  Â  // 4. é‡æ–°è¨ˆç®— Total Time
Â  Â  calculateTotalStopTime();
Â  Â  
Â  Â  // 5. æ¸…é™¤åœ–ç‰‡é è¦½ï¼ˆå› ç‚ºåœ–ç‰‡ç„¡æ³•å¾ Apps Script åå‘è¼‰å…¥ï¼‰
Â  Â  processedImageBase64 = "";
Â  Â  const preview = document.getElementById('preview-img');
Â  Â  preview.style.display = 'none';
Â  Â  preview.src = "";
Â  Â  document.querySelector('.placeholder').style.display = 'block';

Â  Â  // æç¤ºä½¿ç”¨è€…
Â  Â  // alert(`ç´€éŒ„ #${data.formNo} å·²æˆåŠŸè¼‰å…¥ï¼\næ‚¨å¯ä»¥è£œå…… Solution / Self Actions / æ™‚é–“ / åœ–ç‰‡ï¼Œç„¶å¾Œé»æ“Š [Save to Cloud] é€²è¡Œæ›´æ–°ã€‚`);
}
</script>

</body>
</html>
